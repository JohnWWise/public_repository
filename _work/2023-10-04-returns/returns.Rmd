---
title: "FDOC Returns to Incarceration"
description: |
  This document presents an ongoing investigation into returns to incarceration in Florida.
output:
  distill::distill_article:
    toc: true
    toc_float: true
    toc_depth: 2
    df_print: paged
---
The Florida Department of Corrections makes its OBIS database accessible for public download [here](https://fdc.myflorida.com/pub/obis_request.html).

This document is an ongoing mining of that data. Keep an eye out for my newsletter (which doesn't exist yet) for updates, or press F5 to refresh.

<ul>
    <li>
      <details>
        <summary>Importing libraries, setting seed</summary>
        <p>
```{r libraries and seed, echo=TRUE}
# Packages utilized:
pkgs = c("readxl",
         "dplyr",
         "ggforce",
         "kableExtra",
         "gridExtra",
         "DT",
         "tidyr")
inst = lapply(pkgs, library, character.only = TRUE)
set.seed(8675309)
```
  </p>
  </details>
  </li>
</ul>

<ul>
    <li>
      <details>
        <summary>Importing Data, Preprocessing and Cleaning</summary>
        <p>
Importing
```{r}
base_dir <- "/Users/johnwise/Downloads"
Root <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"))
Incarhist <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"), sheet = 6)
Offenses_CPS <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"), sheet = 3)
Offenses_PRPR <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"), sheet = 4)
```

Isolating first-timers
```{r}
first_timers <- Incarhist %>%
  arrange(DCNumber, desc(ReceiptDate)) %>%
  group_by(DCNumber) %>%
  mutate(row_num = row_number()) %>%
  filter(row_num <= 2) %>%
  select(-row_num) %>%
  count(DCNumber) %>%
  filter(n==1)

returners <- anti_join(Incarhist, first_timers, by ='DCNumber')
# grab the two most recent receipts of those who have returned
returners_current_and_last <- returners %>%
  arrange(DCNumber, desc(ReceiptDate)) %>%
  group_by(DCNumber) %>%
  mutate(row_num = row_number()) %>%
  filter(row_num <= 2) %>%
  select(-row_num)
```
Calculate total time served for each person prior to most recent incarceration
```{r}
served_prior <- returners %>%
  mutate(time_served = ifelse(!is.na(ReleaseDate), as.numeric(difftime(ReleaseDate, ReceiptDate, units = "days")), NA)) %>%
  group_by(DCNumber) %>%
  summarize(prev_TimeServed = sum(time_served, na.rm = TRUE))
```
Discovering the amount of time each returned person was free last time they were out
```{r}
returners_time_free <- returners_current_and_last %>%
  group_by(DCNumber) %>%
  summarise(TimeOut = as.numeric(difftime(max(ReceiptDate, na.rm = TRUE), max(ReleaseDate, na.rm = TRUE), units = "days"))) %>% # Note, there were 7 entires for which a negative time free was calculated. Investigation shows
  filter(TimeOut >= 0) # that this is due to these individuals having missing most ReceiptDate for most recent conviction.
# We omit these 7 observations for the purpose of this analysis
```
Determining how many times each person has been incarcerated
```{r}
times_in <- returners %>%
  group_by(DCNumber) %>%
  summarize(times_in = n())
```
Going back to fetch general information on those isolated, compiling with calculated values
```{r}
returners_a <- merge(merge(merge(Root, returners_time_free, by = 'DCNumber'), served_prior, by = 'DCNumber'), times_in, by = 'DCNumber')
```
Removing outlier, binning data
```{r}
# Not sure why the FDOC has the individual with DC Number 872984 as initially coming to prison on 1901-01-01, 
#but we will omit this individual from our analyses as well.
returners_a <- returners_a[-which(returners_a['DCNumber']=='872984'),]

# Create the 'times_in_bins' column
returners_a$times_in_bins <- cut(returners_a$times_in,
                                 breaks = c(2, 3, 4, 6, 17),
                                 labels = c("2 bids", "3 bids", "4-6 bids", "6-17 bids"),
                                 include.lowest = TRUE)

# Create the 'prev_TimeServed_bins' column
breaks <- c(0, 1, 3, 5, 10, 25, 50)
labels <- c("0-1 Years", "1-3 Years", "3-5 Years", "5-10 Years", "10-25 Years", "25-50 Years")
returners_a$prev_TimeServed_bins <- cut(returners_a$prev_TimeServed / 365.25,
                                       breaks = breaks,
                                       labels = labels,
                                       include.lowest = TRUE)
```

  </p>
  </details>
  </li>
</ul>


# Inital Look
```{r fig.align = 'center', code_folding = TRUE}
prop_returned <- round(dim(returners_a)[1]/dim(Root)[1],2)
mean_incarcerations <- round((sum(returners_a$times_in) + dim(first_timers)[1])/dim(Root)[1],2)

new_data <- data.frame(times_in_bins = rep("First FDOC Commitment", dim(first_timers)[1]))
combined_data <- rbind(returners_a %>% select(times_in_bins), new_data)
ggplot(combined_data, aes(x = "", fill = times_in_bins)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = c("#2c7bb6", "#abd9e9" ,"#ffffbf", "#fdae61", "#e6e6e6", "#7f3b00")) +
  theme_void() +  # Remove axis and grid lines
  labs(title = "Times Incarcerated, Currently Incarcerated FDOC Population", fill = "Times FDOC Incarcerated")
```

Amazingly, a full `r prop_returned * 100`% of our currently incarcerated population has served time previously. The Florida Department of Corrections (FDOC) seems to appreciate repeat customers; I've heard them say so myself.
Furthermore, the average number of times a person has been incarcerated across the entire population is `r mean_incarcerations`. In other words, the average person currently incarcerated in FDOC has been incarcerated more than twice before.

What does this information imply about the argument for incarceration as a deterrent?

Regarding the argument on incarceration as a deterrent, I pose this question: How many crimes has the threat of incarceration prevented YOU from committing?

If your answer is "none," then you are likely in the majority. 

If your response is "none, but I'm not a criminal," then it is worth reflecting on the following: Who are the criminals? What do they look like? Where do they come from? Which neighborhoods do they reside in? How comfortable are you with your answers?

## Time Free Since Last Release

Next, we should examine the amount of time that those who are currently incarcerated in Florida were free in between their current and their last incarceration:

```{r fig.align='center', fig.height=5, fig.width=10, code_folding = TRUE}
quartiles <- round(quantile(returners_a$TimeOut, probs = c(0.25, 0.5, 0.75))/365.25, 1)

color_palette <- c("#ffffff", "#e6e6e6", "#bfbfbf", "#808080", "#404040", "#000000")



# Create the first plot (plota)
plota <- ggplot(returners_a, aes(x = 1, y = TimeOut / 365.25, color = prev_TimeServed_bins, group = 1)) +
  geom_sina(alpha = 0.5, position = 'dodge') +
  geom_violin(alpha = 0.1, color = "black") +
  scale_color_manual(values = color_palette, name = 'Served') +
  ylab("Years Free") +
  theme_void() +  # Remove axis and grid lines
  theme(axis.text.y = element_text()) +  # Keep y-axis labels
  labs(title = "Years Free, Shaded by Previous Fl. Time Served")


color_palette <- c("#ffffff", "#e6e6e6", "#404040", "#000000")

# Create the second plot (plotb)
plotb <- ggplot(returners_a, aes(x = 1, y = TimeOut / 365.25, color = times_in_bins, group = 1)) +
  geom_sina(alpha = 0.5) +
  geom_violin(alpha = 0.1, color = "black") +
  scale_color_manual(values = color_palette, name = 'Number of Bids') +
  ylab(NULL) +
  theme_void() +  # Remove axis and grid lines
  theme(axis.text.y = element_text()) +  # Keep y-axis labels
  labs(title = "Years Free, Shaded by Number of Incarcerations")

# Customize plot margins for both plots
plota <- plota + theme(plot.margin = margin(0, 0, 0, 0, unit = "pt"))
plotb <- plotb + theme(plot.margin = margin(0, 0, 0, 0, unit = "pt"))

# Arrange the plots using grid.arrange
grid.arrange(plota, plotb, ncol = 2, top = "Respite Amidst Most Recent Incarcerations, Current FDOC Population")
```

It is evident from the visuals that a majority of individuals currently incarcerated in Florida with a history of previous FDOC incarceration did not have a significant period of freedom before their current imprisonment. Interestingly, there is also a pattern where individuals who had served long sentences in the past or multiple sentences were unable to remain free for long before being incarcerated again. These patterns are shown by the darker points towards the bottom of the visuals. While one might (naively) expect that spending more time in prison or having multiple sentences would make individuals better equipped to stay out longer and remain free, in reality it is not surprising to see evidence here that the longer someone is inside, the *less* equipped they are to navigate the challenges after release.

### Time Free

```{r code_folding = TRUE}
quartile_table <- data.frame(
  "Quartile" = c("Q1", "Median (Q2)", "Q3"),
  Years_Free = quartiles
)

kable(quartile_table) %>% 
  kable_styling(latex_options = "hold_position")

```


For individuals who are currently incarcerated and have previously served time in Florida, a quarter of them were returned to prison in less than 1.8 years after their most recent release, while half of them were not out longer than 3.2 years. Furthermore, only 25% of them managed to stay out of prison for more than 5.7 years.

It is clear that many people are going back to prison very quickly, which raises concerns.

Think about this, however: having 3.2 years of freedom is actually enough time for someone to regain some responsibilities and dignity -- it is already difficult to regain these once (or maybe gain them for the first time), but to only have a fleeting taste of them? I do not know that I could recover from something like that.

# Charges

```{r code_folding = TRUE}
returners_hist <- merge(returners_a, Offenses_CPS, by = 'DCNumber')
returners_hist$adjudicationcharge_descr <- as.factor(returners_hist$adjudicationcharge_descr)

charges <- returners_hist %>%
  group_by(adjudicationcharge_descr) %>%
  summarize(charge_count = n()) %>%
  arrange(desc(charge_count))

raw_charges <- rbind(Offenses_CPS %>% select(adjudicationcharge_descr), Offenses_PRPR %>% select(adjudicationcharge_descr))
raw_charges$adjudicationcharge_descr <- as.factor(raw_charges$adjudicationcharge_descr)
charges_counts <- raw_charges %>%
  group_by(adjudicationcharge_descr) %>%
  summarize(charge_count = n()) %>%
  arrange(desc(charge_count))
```


Currently incarcerated individuals are associated with 1,124 different charges across all past and current incarcerations.

```{r code_folding = TRUE}
datatable(unique(charges_counts), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

In order to proceed, I had to reduce these 1,124 categories to something workable, I needed more general categories of crimes -- drug crimes, violent crimes, etc. Categorizing crimes is a time-consuming process that requires making multiple classification decisions. These decisions can sometimes seem subjective, even to the person making them. It is important to acknowledge that there are alternative crime categorization systems that may be equally or more effective. I encourage everyone to review the crime categorizations by clicking the disclosure triangle icon next to "View Crime Category Mappings". If any errors or inconsistencies are found, or if you wish to suggest an alternative classification framework, please don't hesitate to contact me.

<ul>
    <li>
      <details>
        <summary>Forming Categories</summary>
        <p>
### Burglary, Theft, and Property Crimes
```{r code_folding = TRUE}
burglary_theft_keywords <- c(
  "BURGLARY",
  "BURGUNOCCSTRUC",
  "THEFT",
  "BURGL",
  "BREAK-IN",
  "STOLEN PROPERTY",
  "LARCENY",
  "BURGLARY TOOLS",
  "GRAND THEFT MOTOR VEHICLE",
  "RETAIL THEFT",
  "THEFT COPPER/NONFER.METALS",
  "GRAND THEFT W/DAMAGE",
  "SELL/ETC UNNUMBERED AUTO",
  "ORG RETAIL THEFT > 3K",
  "THEFT>65YO>$300<$10K",
  "BURG/DWELL/OCCUP.CONVEY",
  "BURG/N/ASSLT/OCC.STRUCT",
  "BURG/TREPASS",
  "PURSE",
  "STOLEN VEHICLE",
  "GT",
  "BURG.-STRUCT",
  "ARSON",
  "VANDALISM",
  "TRESPASSING",
  "SHOPLIFTING",
  "MOTOR VEHICLE THEFT",
  "LARCENY",
  "VEHICLE THEFT/ILLEGAL USE",
  "CRIMINAL DAMAGE TO PROPERTY",
  "RECEIVING STOLEN PROPERTY",
  "BURGLARY OF A VEHICLE",
  "PETTY THEFT",
  "OFFERS FOR SALE",
  "GRAND THEFT",
  "OBTAIN GOODS",
  "CREDIT CARD FRAUD",
  "PROP. STOLEN;EMRG.MED EQP.",
  "MAIL THEFT",
  "BICYCLE THEFT",
  "SHOPPING CART THEFT",
  "VEHICLE PARTS THEFT",
  "BUILDING BREAKING AND ENTERING",
  "CRIMINAL TRESPASS",
  "CRIMINAL MISCHIEF",
  "GRAFFITI",
  "INT./RECKLESS BURN LAND",
  "CRIMINAL TAMPERING",
  "ARSON OF A VEHICLE",
  "LOOTING",
  "HOME INVASION",
  "EXTORTION",
  "STOLEN PROPERTY TRAFFICKING",
  "PROPERTY DAMAGE",
  "VANDALISM OF GOVERNMENT PROPERTY",
  "PROPERTY",
  "SNATCH",
  "DAMAGE PROPERTY-OTHER",
  "FALSE APPL./STATE.",
  "CHOP SHOP",
  "STOLEN CARGO",
  "METAL RECYCLER",
  "ARSON, PROPERTY DEFRAUD",
  "GRAND THEFT MOTOR VEHICLE",
  "POSSESS STOLEN VEHICLE",
  "STOLEN VEHICLE - OTHER",
  "POSSESS MOTOR W"
)
```
### Drug Offenses
```{r code_folding = TRUE}
drug_offenses_keywords <- c(
  "DRUG",
  "BARBITURATE-POSSESS",
  "NARCOTIC",
  "COCAINE",
  "COC.",
  "MANUFAC. POSS W",
  "MARIJUANA",
  "IMIT.CON.SUBS.",
  "HEROIN",
  "GHB",
  "10GR.HER.SCH.I",
  "SCH I & II",
  "MINOR-BATHSALTS",
  "METHAMPHETAMINE",
  "TABLETING MACHINE",
  "PRESCRIPTION FRAUD",
  "DRUG PARAPHERNALIA",
  "CONTROLLED SUBSTANCE",
  "POSSESSION OF CONTROLLED SUBSTANCE",
  "POSSESSION OF DRUG PARAPHERNALIA",
  "DRUG DISTRIBUTION",
  "POSSESSION OF NARCOTICS",
  "EPHEDRINE",
  "CONTRL.SUBST.",
  "POSSESSION OF METHAMPHETAMINE",
  "DRUG TRAFFICKING WITHIN 1000 FT OF SCHOOL",
  "POSSESSION OF COCAINE",
  "POSSESSION OF HEROIN",
  "POSSESSION OF MARIJUANA",
  "SELLING DRUGS",
  "TRANSPORTATION OF CONTROLLED SUBSTANCE",
  "POSSESSION WITH INTENT TO DISTRIBUTE",
  "DRUG ABUSE",
  "DRUG TRAFFICKING W/INTENT TO SELL",
  "FELONY POSSESSION OF CONTROLLED SUBSTANCE",
  "HALLUCINOGEN-OTHER-NON MARIJ",
  "CONSTRUCTIVE POSSESSION",
  "METH",
  "POSS.CONTROL.SUBS/OTHER",
  "POSS/DIST.CHEM.TO MFG.SUB",
  "DRUGS",
  "SALE MAR.ETC",
  "SELL/ETC/COC/HER/1K",
  "AMPHETAMINE-PUR/POSS/W/INT",
  "AMPHETAMINE-POSSESS",
  "AMPHETAMINE",
  "TRAFF",
  "BARBITUATE",
  "CONTR.SUBST.",
  "CON.SUBST.",
  "CONT.SUB",
  "OPIUM",
  "POS PLAC MAN SUB/MINOR EXIST",
  "S/M/D",
  "SALE OF COUNTERFEIT DRUGS",
  "MARIJ",
  "DEAL DRGS",
  "DEAL/ETC.MAJR.DRG",
  "SYN.NARC",
  "SMD",
  "MDMA",
  "ROHYPNL",
  "OWN/RENT STRUC/CONV TRAF/MAN",
  "MARIJ/LSD-SALE/DEL.TO",
  "DIST.OF NIT.OX.",
  "INJECT/INHALE",
  "ETC.MINR.DRG NEAR ALF"
)
```

### Violent Crimes
```{r code_folding = TRUE}
violent_crimes_keywords <- c(
  "HOMICIDE",
  "MURDER",
  "HOMCID-NO",
  "CARJACK",
  "MANSLAUGHTER",
  "ASSAULT",
  "AGGRAVATED ASSAULT",
  "BATTERY",
  "ROBBERY",
  "KIDNAPPING",
  "STALK VIO INJ",
  "ARSON",
  "DOMESTIC VIOLENCE",
  "CARJACKING",
  "ARMED ROBBERY",
  "DISCHARGE F/A FR.VEHICLE W/I 1",
  "AGGRAVATED BATTERY",
  "STALK VIO INJ VIO 2+ PRI CON",
  "VEHICLE HOMCID-NO AID/INFO",
  "AGGRAVATED SEXUAL ASSAULT",
  "AGGRAVATED DOMESTIC VIOLENCE",
  "AGGRAVATED CARJACKING",
  "ATTEMPTED MURDER",
  "SER.INJ/FRM",
  "AGGRAVATED ARSON",
  "AGGRAVATED KIDNAPPING",
  "AGGRAVATED BURGLARY",
  "CRIMINAL HOMICIDE",
  "ASSAULT WITH A DEADLY WEAPON",
  "ASSAULT ON A LAW ENFORCEMENT OFFICER",
  "ARMED ASSAULT",
  "CHILD ABDUCTION",
  "GUNSHOT WOUND",
  "STABBING",
  "FIREARM POSSESSION",
  "AGGRAVATED BATTERY WITH A DEADLY WEAPON",
  "ROBB.",
  "2ND DEG.MURD",
  "MURD",
  "AGG ASSLT-W/WPN",
  "BATT.LEO/FIRFGT/EMS/ETC.",
  "BATT.",
  "ASSLT-INTENT",
  "AGGRAV ASSLT-NONFAMILY-GUN",
  "KIDNAP;COMM.OR FAC.FELONY",
  "MUR/PREMED",
  "AGGRAV ASSLT",
  "KIDNAP",
  "FORCIBLE",
  "FALS.IMPRSN-NO",
  "AGGRAV ASSLT",
  "AGG.ASSLT/LEO/FIREFGT/EMS/ETC.",
  "MUR,COM.OF",
  "IMPRISON",
  "HARMS PUBLIC SERVANT",
  "DISCHARGE F/A FR.VEHICLE W/I 1",
  "MANSL",
  "DOM VIO",
  "BOD.INJ./NOT",
  "BRAND CHILD - TRAFFICKING",
  "FALSE IMPRISON MINOR AGA.WILL",
  "FORCIBLE PURSE SNATCHING",
  "SUDDEN SNATCH NO WEAPON",
  "SUDDEN SNATCH F/A OR DW",
  "HOMICIDE NEGLIG MANSL VEH",
  "HUMAN SMUGGLING",
  "ILLEGAL OBT.LABOR W/FORCE"
)
```

### Sex Crimes
```{r code_folding = TRUE}
sex_crimes_keywords <- c(
  "SEXUAL",
  "SEX",
  "RAPE",
  "AGGRAVATED RAPE",
  "AGGRAVATED SEXUAL ASSAULT",
  "SEX OFFENSE",
  "INCEST",
  "INDECENT EXPOSURE",
  "CHILD PORNOGRAPHY",
  "CHILD SEXUAL ABUSE",
  "STATUTORY RAPE",
  "ADLT/CUST VID",
  "SEXUAL HARASSMENT",
  "FORCIBLE SODOMY",
  "LEWD AND LASCIVIOUS CONDUCT",
  "SEXUAL EXPLOITATION",
  "CHILD MOLESTATION",
  "SEXUAL MISCONDUCT",
  "SEXUAL EXPLOITATION OF A MINOR",
  "INDECENT ACT WITH A CHILD",
  "SEXUAL PREDATOR",
  "FORCED SEX",
  "VOYEURISM",
  "NONCONSENSUAL SEX",
  "SEXUAL ABUSE OF A MINOR",
  "GROOMING A MINOR FOR SEXUAL EXPLOITATION",
  "SOLICITATION OF A MINOR FOR SEXUAL CONDUCT",
  "ONLINE SEXUAL ENTICEMENT OF A MINOR",
  "CHILD SEX TRAFFICKING",
  "PROSTITUTION",
  "PROSTITUTION RING",
  "PIMPING",
  "SEX TRAFFICKING",
  "INDECENT ASSAULT",
  "UNLAWFUL SEXUAL INTERCOURSE",
  "AGGRAVATED INDECENT ASSAULT",
  "FORCED PROSTITUTION",
  "FORCED SEXUAL SERVITUDE",
  "MOLEST",
  "L/L",
  "SEX ASSLT - CARNAL ABUSE",
  "PROV.OBSCENE MAT.MINOR",
  "L&L",
  "IMPREG.GRL",
  "CRIM.SOLIT.CHILD",
  "TRFC:SX",
  "FORCE TO BECOME PROSTITUTE",
  "PROCURE FOR",
  "CHILD PORN.",
  "PROST",
  "LEWD",
  "TFK:LABOR",
  "LURE CHILD",
  "MINOR SX MATERIAL",
  "L&L BATT FORCE/ENTICE ABUSE",
  "SEX BAT/COERCES BY THREAT",
  "VID VOYEUR"
)
```

### Crimes of Incarceration and Criminal Identity
```{r code_folding = TRUE}
incarceration_related_crimes <- c(
  "ESCAPE",
  "INTRODUCTION OF CONTRABAND",
  "ASSAULT ON STAFF",
  "PRISON RIOT",
  "INTRO.INTOXICATING",
  "CONTR.SUB.INTO",
  "INMATE ON INMATE ASSAULT",
  "UNAUTHORIZED POSSESSION OF WEAPONS",
  "RIOTING IN A CORRECTIONAL FACILITY",
  "ATTEMPTED ESCAPE",
  "CONTRABAND TRAFFICKING",
  "INMATE MUTINY",
  "LEO",
  "PAROLE VIOLATION",
  "DEL.FA PERSON PROHIB.POSS",
  "FAIL.TO",
  "CONTRA JUV FACILITY",
  "UNAUTH. COMP. ACCESS",
  "STAFF-ON-INMATE ASSAULT",
  "STAFF INVOLVEMENT IN CONTRABAND SMUGGLING",
  "INMATE EXTORTION",
  "BY FELON",
  "FEL/DELI W/GUN/CONC WPN/AMMO",
  "CO DET FAC",
  "FAILURE TO APPEAR",
  "CONTRABAND-PRISON",
  "INTRODUCE",
  "CONTRABAND",
  "DETENTN FAC",
  "APPEAR/FEL.BAIL",
  "REGISTER-CAREER CRIM",
  "RESISTING OFFICER W/VIOLEN.",
  "FLEE",
  "OFFENDER",
  "INTRODUCING",
  "PRISONERS",
  "FAIL TO REGISTER",
  "REGISTR.VIOL.",
  "DAMAGE ELEC.MONITOR.EQUIP.",
  "RIOT",
  "PRISONER",
  "2-WAY COMM.",
  "CORRECTION STAFF",
  "RESIST.LEO",
  "NOTIF.SHERIFF",
  "BRING INTO STA/CONTR SUBST",
  "EXCON",
  "CELL PHONE IN PRISON",
  "DETAINEE",
  "GANG MEMBERSHIP",
  "RE SX.OFNDR.",
  "OFFICIAL/EMPLOYEE",
  "MISD. TO FEL.BY GANG MEMBR",
  "BENEFIT GANG",
  "PREVIOUS CONVICT",
  "VLNT.CAREER CRIM.POSS.GUN",
  "CONTRAB.",
  "ASSAULT BY INM W/N CO FACILITY",
  "BATTERY ON DETENT.FAC.STAFF",
  "BATTERY OF HRS EMPLOYEE",
  "BATT. RYCE FACILITY STAFF",
  "AGG.BATT. RYCE FAC. STAFF",
  "SEX PRED, TRANS RES NO REP",
  "SEX OFF, TRANS NO REP",
  "DEFACE RYCE DET. FACILITY",
  "GANG ACTIVITIES",
  "CONTINUING CRIMINAL ENTER",
  "MISC VIOLATIONS",
  'FAIL RPT.NONMOVE',
  "ELEC. MON. DEVICE",
  "DAMAGE ELEC.MONITOR.EQUIP",
  "CONDIT RELEASE VIOLATION",
  "SUPERVISION VIOLATION",
  "WIRETAP-FAILURE TO REPORT",
  "COMPLY PSIA"
)
```


### White-Collar and Fraud
```{r code_folding = TRUE}
white_collar_fraud_crimes <- c(
  "EMBEZZLEMENT",
  "EXTORTION",
  "FRAUD",
  "FORGERY",
  "CREDIT CARD FRAUD",
  "CRM. W/FAKE LEGAL PROCESS",
  "CHECK FRAUD",
  "IDENTITY THEFT",
  "WIRE FRAUD",
  "RACKETEER",
  "INSURANCE FRAUD",
  "MONEY LAUNDERING",
  "SECURITIES FRAUD",
  "TAX EVASION",
  "STRUCT $ TRANS>100K",
  "INSIDER TRADING",
  "BANK FRAUD",
  "EMBEZZLE-BANKING-TYPE INST",
  "COUNTERFEITING",
  "SUPPLY STOLEN/FAKE",
  "CREDIT CARD SKIMMING",
  "AGENT/ISSUE LICENSE REQUIREMEN",
  "PONZI SCHEME",
  "ALTER ID",
  "RACKETEERING",
  "PHISHING",
  "INVESTMENT FRAUD",
  "ONLINE SCAMS",
  "WIRE TRANSFER FRAUD",
  "MAIL FRAUD",
  "TELEMARKETING FRAUD",
  "COUNTERFEIT CURRENCY",
  "COUNTERFEIT GOODS",
  "COUNTERFEIT DOCUMENTS",
  "MORTGAGE FRAUD",
  "OBTAIN PROP",
  "VIN-TITLE-ETC",
  "INTERNET FRAUD",
  "BANKRUPTCY FRAUD",
  "HEALTHCARE FRAUD",
  "DENY COMPUTER SERV W/INT DEF",
  "PUBLIC CORRUPTION",
  "BID-RIGGING",
  "ANTITRUST VIOLATIONS",
  "ENVIRONMENTAL FRAUD",
  "SECURITIES VIOLATIONS",
  "CIVIL FRAUD",
  "WELFARE FRAUD",
  "BENEFIT FRAUD",
  "GRANT FRAUD",
  "MAKE FALSE REPORT",
  "STUDENT LOAN FRAUD",
  "PROPERTY FLIPPING",
  "CREDIT REPAIR SCAMS",
  "FRAUDULENT LOANS",
  "PENSION FUND FRAUD",
  "REAL ESTATE FRAUD",
  "FALSE STATMT",
  "CONSUMER FRAUD",
  "PYRAMID SCHEMES",
  "BURGL AUTHORIZED EMER VEHICLE",
  "INTELLECTUAL PROPERTY FRAUD",
  "FORGED",
  "FALS INF. TO",
  "PASS TITLE",
  "CONTERFEIT LOTTERY",
  "CHECKS",
  "BRIBERY",
  "LOTTERY",
  "ANTITRUST",
  "UTTERING",
  "FALSE NAME",
  "UNNUMBERED AUTO",
  "FALSE REPORTS",
  "COUNTERFEIT",
  "CREDIT CARD",
  "RECEIV. PROCEEDS",
  "FILING FALSE DOCUMENTS",
  "RACKTEERING",
  "LAUNDER",
  "CREDIT",
  "SALES/FALSE APP",
  "TRANS>100K",
  "TRANSMITTER",
  "BROKERING",
  "EXPL",
  "FORGE",
  "ODOMETER",
  "FALSE STATEMENT",
  "BRIBES",
  "FALSE CERTIFICATE",
  "MISREPRESENTATION",
  "PRACTICE MEDICINE",
  "NATURO",
  "DEAL STOLEN",
  "EXP ELDER DISABLD",
  "SUBMIT FALSE",
  "MAKING FALSE REPORT",
  "MISAPPRO.FUNDS",
  "UNLAWFUL COMPENSATION",
  "BUY,SELL VESSEL W/ALT.NUM.",
  "CREATE FALSE",
  "DEAL.INS.NO CERTIF/AUTH.",
  "POSS PRSNL ID INF 5+ PERSONS",
  "UNAUTH POSS/USE OF DL/ID",
  "POSS PRSNL ID",
  "TRAFF CRED CARDS 5-14",
  "TRAFF CRED CARDS 15-49",
  "S/M/D STOLEN ETC.DL/IDFACT",
  "FALSE APPL./STATE. RE:DL",
  "PASS TITLE ON STOLEN VEHICLE",
  "STAGE CRASH FOR INS. CLAIM",
  "CHECKS AND DRAFTS VIOLATIONS",
  "DRUG ABUSE-FRAUD MATERIAL",
  "ILLEGAL LIC PLATE",
  "STAGE CRASH FOR INS. CLAIM",
  "DISCLOSE/OBTAIN CRASH INFO",
  "SKIMMING DEV",
  "FALS.MV INS. APPLICATION",
  "EMP - CONSTR.POSSESS CB",
  "MARINE LIFE VIO",
  "GIVE CLD TO UNAUTH.PERSON",
  "AGG. WHITE COLLAR CRIME",
  "FALSE DOC/OWN FIN LOSS",
  "TRANS>20K<100K",
  "FALSE DOCNUMENTS",
  "INSUR.AGNT",
  "MEDICAID PRVDR",
  "TRANS>300<20K",
  "EMBEZZLE-BUSINESS",
  "FAIL RE ESCROW",
  "PROCURE TITLE",
  "LABEL TAMPERING"
)
```
### Motor Vechile Crimes
```{r code_folding = TRUE}
traffic_crimes <- c(
  "SPEEDING",
  "DRIV.W/O",
  "DRV",
  "LEAVE VESSEL ACDT",
  "TAG-MISD.",
  "DUI",
  "BUI",
  "CDL C/S/R/D 2nd+",
  "HIT AND RUN",
  "RECKLESS DRIVING",
  "DRUNK DRIVING (DUI/DWI)",
  "DRIVING WITHOUT A LICENSE",
  "DRIVING WITH A SUSPENDED LICENSE",
  "RUNNING A RED LIGHT",
  "DRIVING WITHOUT INSURANCE",
  "LEAVING THE SCENE OF AN ACCIDENT (HIT AND RUN)",
  "TEXTING WHILE DRIVING",
  "DISTRACTED DRIVING",
  "DRIV W/LIC",
  "FAIL STOP CRASH INJ/DEATH",
  "TOW/STORE VEH.VIOL.",
  "UNAUTH USE",
  "DWLSR",
  "DRIVE-BODILY",
  "LEAVE ACCIDENT",
  "DRIVE",
  "BOATING",
  "TRAFFIC OFFENSE",
  "LEAVE CRASH",
  "LVE CRASH"
  
  )
```

### Abuse/Neglect
```{r code_folding = TRUE}
abuse_neglect_crimes <- c(
  "CHILD ABUSE-NEGLECT",
  "ABUSE CHILD-INJURY",
  "ABUSE-NEGLECT",
  "NEGLCT",
  "CHILD ABUSE",
  "ALS.IMP. V<13/AGG.CHLD ABUSE",
  "ABUSE CHILD",
  "BUSE ELDER/DISABLD-INJURY",
  "CHILD NEGLECT",
  "NEGLECT CHILD",
  "AGG.ABUSE",
  "ABUSE ELDER",
  "DEPRIVE VIC MED/COND WORSENS",
  "FALSIFY CARE RCRD",
  "FAMILY OFFENSE-OTHER",
  "LEAVE CHILD IN CAR",
  "GUARDIAN SELLS CHILD"
)

```

### Other Crimes
```{r code_folding = TRUE}
other_crimes <- c("CARRYING CONCEALED FIREARM",
                  "UNQUALIFIED VOTER",
                  "LIQUOR-POSSESSION BY MINOR",
                  "POSSES VEH W/ILL LIC PLATE",
                  "POSS/USE HOX BMB-FLNY/ATT.",
                  "FLEE LEO/NO REGARD",
                  "FILE FALSE DOC PUB",
                  "OBSCENE MATERIAL-DISTRIB",
                  "OFFICIAL MISCONDUCT",
                  "ENG. INS. ACT. NO LICENSE",
                  "MAIMS ANIMAL",
                  "FAILS GIVE NOTICE/SPILL",
                  "WIRE COMM.OBT'D UNLAWFULLY",
                  "OFF BY AUTH FIG AGAINST STU",
                  "WIT.ACPT.BRIBE,FALSE TEST",
                  "ROVIDE FALSE REPORT STD",
                  "POSS.SELL,INSTALL AIRBAG",
                  "OBSTRUCT",
                  "TAB MACHINE, ILLEG. KNOWLEDGE",
                  "IMPRSN.LEO",
                  "PRESCRIBER",
                  "BOILER RM.SALES O/50,000",
                  "$ TRANSMITTER >$100K",
                  "FAILED TO RETURN",
                  "WILLFUL FLEE/ELUDE LEO",
                  "EAPON OFFENSE-OTHER",
                  "DISCH.DESTR.DEVICE",
                  "COMMIT 815.06(3)(B)",
                  "USE HOAX WEAP MASS DEST",
                  "POSSESS ILLEGAL WEAPON",
                  "MISD. TO FEL. W/PREJUDICE", #I don't know what this is
                  "INTIMIDATE/FORCE WITNESS",
                  "DISCHARGE DESTRUC.DEVICE",
                  "GAMBLING-OTHER",
                  "SEC MET RECYCL 3RD SUB VIO",
                  "CONCEAL CHILD DUR.CUS.PROCEED",
                  "CONCEAL CHILD NON-CUS PARENT",
                  "SEND MINOR HARM.INFO-OTH STATE",
                  "W/H INFO. FROM PRESCRIBER",
                  "MISDEMEANOR",
                  "MARINE LIFE VIO",
                  "DIVULGE EAVESDROP INFO",
                  "OFF AGAINST INTELLECT PROP",
                  "STALK VIO INJ VIO 2+ PRI CON",
                  "RAC.HLTHCARE",
                  "OBSCENE MATERIAL-SELL",
                  "INTERFERE W/ RR/EQUIP",
                  "FALSE INFO",
                  "OBSOLETE DATA-BEFORE EST.CODES",
                  "TRESPASS",
                  "ANIMAL CRUELTY",
                  "ENDANG. SPECIES",
                  "PRESCP BLANK",
                  "FAIL TO RETURN RENTED VEH.",
                  "UNKNOWN",
                  "DISCH.WEAP.SCHOOL GROUNDS",
                  "THREATENS",
                  "SHOOT/THROW MISSILE",
                  "PERJURY",
                  "DIST HARM MAT",
                  "DIRECT PERSON TO DISC. F/A FR.",
                  "ACCESSORY",
                  "AGG.STALK",
                  "JURY TAMPERING",
                  "INTIMIDATION",
                  "AGAINST THE STATE",
                  "WITNESS",
                  "MISUSE OF 911",
                  "TAMPER/COMMAND",
                  "DENTISTRY",
                  "WORKER COMP",
                  "ADOPTION DECEPTION",
                  "TRESP",
                  "AGGRAVATED STALKING",
                  "SEND MINOR HARMFUL INFO.",
                  "MPERSON LEO COM. OF FEL",
                  "DEPRIVE OFFR OF PROTECT.",
                  "THREATS",
                  "CONTEMPT",
                  "STORES HAZAR WASTE",
                  "INTERFERS W/CUSTODY PARENT/GUA",
                  "PUBLIC PEACE",
                  "UNLAWFUL ACCESS STORED COMMUN.",
                  "KEEP FIREFIGHTER FROM DUTY",
                  "LIVE OFF PROSTIT.EARN",
                  "INTERFERS W/CUSTODY CHILD",
                  "INJ/KILL PD/FD/SAR ANIMAL",
                  "FALSE REPORT/ FAILURE MAKE REP",
                  "CONC.CRIME",
                  "UNLICENSED CARDROOM",
                  "WILLFULLY MODIFY COMPUTER",
                  "DIST MAT OF MINOR/HARMFL ACT",
                  "EMP - TRANSMIT CB",
                  "THREAT PUB OFF W DEATH 2ND+",
                  "THREAT TO BOMB",
                  "CONSERVATION-OTHER",
                  "USE/CONCEAL/ATT.WPN-FELNY",
                  "INTRNET/F.S.",
                  "TORTURES ANIMAL",
                  "DISRUPTION OF GOVERN OPERATION",
                  "IMPERSONATE",
                  "FALS.RPRT",
                  'PAR.PERM',
                  "DESTROY,MULTI.BURIAL",
                  "FILLING PERSCRIPTIONS",
                  "RK/DMG FENCE",
                  "FEL/DELI",
                  "GAMBLING",
                  "DAMAGE COIN",
                  "DISCH.DESTRUCT.DEV.DAM.",
                  "NO CONTACT ORDER VIOL",
                  "OFF. MISCONDUCT/KNOW REFRAININ",
                  "UNAUTHORIZED LAW PRACTICE",
                  "CHILD SUPPORT",
                  "CRIM. TRANSMISSION HIV",
                  "SECURE FIREARM FROM MINOR",
                  "LITTER",
                  "CONSERVATION",
                  "PROC/UNLAWFUL",
                  "DISCH.DESTRUCT.",
                  "DISPLAY GUN",
                  "SOUND-RECORD",
                  "CAUSES POLLUTION",
                  "SER.INJ/NOT", #I do not know what this one is at all
                  "INTOX-MISD",
                  "OBSCENITY-OTHER",
                  "LIQUOR-OTHER",
                  "POACHING",
                  "DISCHARGING MACHINE GUN",
                  "WEAPON OFFENSE",
                  "FAIL GET FL. WC POLICY",
                  "W/MASK",
                  "POISON FOOD OR WATER",
                  "SHOOT/THROW OBJ.OCC.VEH.",
                  "BAIL BONDSMAN VIOL.",
                  "CONCEAL WPN NOT GUN-MISD.",
                  "bigamy",
                  "UNLICENSED PAWN BROKER",
                  "PRAC.HEALTH CARE",
                  "POSS CONC HANDCUFF KEY",
                  "POSS.5 OR MORE DEVICES",
                  "POSS.WPN.SCH/EVENT/BUS/STOP",
                  "WEAP.W/IN",
                  "INCENDIARY DEVICE-POSSESS",
                  "POSS/DISCH/MAKE DESTR. DEVICE",
                  "POSS.MANUF.FIRE BOMB",
                  "POSSESS WEAPON SCHOOL",
                  "POSS.FIREARM AT SCHOOL",
                  "PAR.AUTH.LET MINOR",
                  "HOAX BOMB",
                  "POSS.ELEC.WPN",
                  "POSSESS FIREARM WHEN PROHIB",
                  "ILGL.VEH.FUEL TRNSPRT",
                  "POSSES.FIREARM",
                  "TURTL/NEST/ETC",
                  "VEST",
                  "HIV-POSITIVE HAS SEX",
                  "CRIMINAL MISCHIEF-MISD",
                  "POSSESSION OF STOLEN EXPLOSIVE",
                  "AIM LASER AT DRIVER/PILOT",
                  "HIV-POS.HAS SEX 2+ VIOLATIONS",
                  "EVIDENCE-DESTROYING",
                  "ABUSE OF HUMAN CORPSE",
                  "USE PUB.RECRD-FACIL.FLNY",
                  "815",
                  "POSS.ALCOHOL",
                  "BUMPSTOCK",
                  "815.06(3)(A)",
                  "DISCLOSE COMM. INFO CRIM. INV",
                  "EMP - CB CELL PHONE",
                  "EMP - CB CONTROL SUB",
                  "SELL/DEL/POSS/INT.SEL CLD",
                  "STALKING - MISD",
                  "DRUNKENNESS",
                  "FALSE FIRE ALARM"
                  )
```
  </p>
  </details>
  </li>
</ul>

<ul>
    <li>
      <details>
        <summary>Mapping to Formed Categories</summary>
        <p>
```{r}
category_mapping <- list(
  "Burglary, Theft, Property Crimes" = burglary_theft_keywords,
  "Drug Offenses" = drug_offenses_keywords,
  "Violent Crimes" = violent_crimes_keywords,
  "Sex Crimes" = sex_crimes_keywords,
  "Crimes of Incarceration/Criminal Identity" = incarceration_related_crimes,
  "White-Collar and Fraud" = white_collar_fraud_crimes,
  "Motor Vechile Crimes" = traffic_crimes,
  "Other" = other_crimes,
  "Abuse/Neglect Crimes" = abuse_neglect_crimes)

charges_counts$crime_category <- NA
# Loop through categories and apply rules
for (category in names(category_mapping)) {
  keywords <- category_mapping[[category]]
  charges_counts$crime_category[grepl(paste(keywords, collapse = "|"), charges_counts$adjudicationcharge_descr, ignore.case = TRUE)] <- category
}
charges_categories <- charges_counts %>% select(-2)
```
  </p>
  </details>
  </li>
</ul>




<ul>
    <li>
      <details>
        <summary>View Crime Category Mappings</summary>
        <p>

```{r include = FALSE}
#unmapped
#unique(charges_counts[which(is.na(charges_counts$crime_category)),]$adjudicationcharge_descr)
```

        
### Burglary, Theft, and Property Crimes
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Burglary, Theft, Property Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```
### Drug Offenses
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Drug Offenses")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Violent Crimes
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Violent Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Sex Crimes
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Sex Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Crimes of Incarceration
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Crimes of Incarceration/Criminal Identity")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### White-Collar and Fraud
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="White-Collar and Fraud")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```
### Motor Vechile Crimes
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Motor Vechile Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Abuse/Neglect
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Abuse/Neglect Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Other Crimes
```{r code_folding = TRUE}
datatable(unique(charges_counts %>% filter(crime_category=="Other")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Proportions of Charges (not persons)
```{r code_folding=TRUE}
charges_counts$crime_category <- as.factor(charges_counts$crime_category)
category_counts <- summary(charges_counts$crime_category)
total_entries <- sum(category_counts)
category_percentages <- (category_counts / total_entries) * 100
rounded_percentages <- as.data.frame(round(category_percentages, 1))
kable(rounded_percentages, 
      col.names = c("Percentage of Crimes Associated with Currently Incarcerated Persons, FDOC")) %>% 
  kable_styling(latex_options = "hold_position")
```

###Finding top three within each category 
```{r}
crimes_categories <- charges_counts %>%
  group_by(crime_category) %>%
  # Arrange by charge_count in descending order within each group
  arrange(desc(charge_count)) %>%
  # Take the top 3 rows within each group
  slice(1:3) %>%
  # Select the columns you want to display
  select(crime_category, adjudicationcharge_descr, charge_count)

result <- crimes_categories %>%
     group_by(crime_category) %>%
     summarize(
         Top_3_counts = paste(adjudicationcharge_descr, charge_count, sep = ", ", collapse = '; ')
     )
```

  </p>
  </details>
  </li>
</ul>

```{r code_folding = TRUE}
kable(result) %>% 
  kable_styling(latex_options = "hold_position")
```

### Aside: Limitation Caused by Poor Data Coding -- Probation/Parole/Conditional Release Violations
While I initially intended to analyze probation/parole violations among individuals currently incarcerated with a previous history of incarceration using this data, it is not currently possible to conduct a straightforward analysis. This is because the Florida Department of Corrections categorizes individuals who are currently incarcerated and have violated their probation/parole under the charge for which they were originally sentenced to probation or parole.

For instance, let's consider the following record, with all identifying information censored. This person was initially incarcerated in 1961 for an unspecified sexual battery crime and received a life sentence. It is important to note that the meaning of a life sentence in 1961 differed significantly from its present-day interpretation. They were released on parole in 1967. After 17 years of freedom, they were arrested in Orange County. Although they were not apparently convicted of a new crime, their detainment resulted in the revocation of their parole, and they have been in prison ever since.

::: {.figure .first-image style="text-align: center; border: 3px solid black;"}
<img src="/Users/johnwise/pubic_repository/images/paroleviolation.png" alt="Screenshot 2023-09-04 at 11.27.33 AM" width="80%"/>

<p class="caption" style="text-align: center; margin-top: -0.5rem; margin-bottom: 0.5rem; font-size: smaller">

Figure 1: Source: <a href="https://fdc.myflorida.com/">Screenshot 2023-10-16 at 17.15.00 PM \| Florida Department of Corrections</a>

</p>
:::

However, the FDOC incorrectly lists this person as currently in prison for the 1961 unspecified sexual battery offense. There are several issues with this, the most significant being that it is not true. This person is NOT in prison for any form of sexual battery, but rather is still ensnared in the legal fallout from the 1961 conviction -- after 17 years of freedom, these are different things, certainly.

### Proportions of Persons Associated with Charges
<ul>
    <li>
      <details>
        <summary>Coding Work for Determining Proportions of Persons Associated with Charges</summary>
        <p>
### First Timers
```{r}
fist_timers_crimes <- merge(first_timers[,1], Offenses_CPS %>% select(DCNumber, adjudicationcharge_descr), by = 'DCNumber')
first_timers_cats <- merge(fist_timers_crimes, crimes_categories, by = 'adjudicationcharge_descr') %>% select(DCNumber, crime_category)

first_time_result <- first_timers_cats %>% 
  group_by(DCNumber) %>% 
  mutate(crimes_categories = paste(crime_category, collapse = "; ")) %>%
  select(-crime_category) %>%
  unique()

first_time_result_counts <- first_time_result %>%
  separate_rows(crimes_categories, sep = "; ") %>%
  count(DCNumber, crimes_categories) %>%
  pivot_wider(names_from = crimes_categories, values_from = n, values_fill = 0)

result_first_timers <- data.frame(Category = character(0), Proportion = numeric(0))
categories <- colnames(first_time_result_counts)[-1]
for (category in categories) {
  num_associated_rows <- first_time_result_counts %>%
    filter(get(category) > 0) %>%
    nrow()
  proportion <- round(num_associated_rows / nrow(first_time_result_counts), 3)
  result_first_timers <- rbind(result_first_timers, data.frame(Category = category, Percent = proportion * 100))
}
```

### Second Timers
```{r}
second_timers <- times_in %>% filter(times_in==2)
second_timers_crimes <- merge(second_timers[,1], Offenses_CPS %>% select(DCNumber, adjudicationcharge_descr), by = 'DCNumber')
second_timers_cats <- merge(second_timers_crimes, crimes_categories, by = 'adjudicationcharge_descr') %>% select(DCNumber, crime_category)

second_time_result <- second_timers_cats %>% 
  group_by(DCNumber) %>% 
  mutate(crimes_categories = paste(crime_category, collapse = "; ")) %>%
  select(-crime_category) %>%
  unique()

second_time_result_counts <- second_time_result %>%
  separate_rows(crimes_categories, sep = "; ") %>%
  count(DCNumber, crimes_categories) %>%
  pivot_wider(names_from = crimes_categories, values_from = n, values_fill = 0)

result_second_timers <- data.frame(Category = character(0), Proportion = numeric(0))
categories <- colnames(second_time_result_counts)[-1]
for (category in categories) {
  num_associated_rows <- second_time_result_counts %>%
    filter(get(category) > 0) %>%
    nrow()
  proportion <- round(num_associated_rows / nrow(second_time_result_counts), 3)
  result_second_timers <- rbind(result_second_timers, data.frame(Category = category, Percent = proportion * 100))
}
```

### Third Timers
```{r}
third_timers <- times_in %>% filter(times_in==3)
third_timers_crimes <- merge(third_timers[,1], Offenses_CPS %>% select(DCNumber, adjudicationcharge_descr), by = 'DCNumber')
third_timers_cats <- merge(third_timers_crimes, crimes_categories, by = 'adjudicationcharge_descr') %>% select(DCNumber, crime_category)

third_time_result <- third_timers_cats %>% 
  group_by(DCNumber) %>% 
  mutate(crimes_categories = paste(crime_category, collapse = "; ")) %>%
  select(-crime_category) %>%
  unique()

third_time_result_counts <- third_time_result %>%
  separate_rows(crimes_categories, sep = "; ") %>%
  count(DCNumber, crimes_categories) %>%
  pivot_wider(names_from = crimes_categories, values_from = n, values_fill = 0)

result_third_timers <- data.frame(Category = character(0), Proportion = numeric(0))
categories <- colnames(third_time_result_counts)[-1]
for (category in categories) {
  num_associated_rows <- third_time_result_counts %>%
    filter(get(category) > 0) %>%
    nrow()
  proportion <- round(num_associated_rows / nrow(third_time_result_counts), 3)
  result_third_timers <- rbind(result_third_timers, data.frame(Category = category, Percent = proportion * 100))
}
```

### Fourth Tiemrs
```{r}
fourth_timers <- times_in %>% filter(times_in == 4)
fourth_timers_crimes <- merge(fourth_timers[, 1], Offenses_CPS %>% select(DCNumber, adjudicationcharge_descr), by = 'DCNumber')
fourth_timers_cats <- merge(fourth_timers_crimes, crimes_categories, by = 'adjudicationcharge_descr') %>% select(DCNumber, crime_category)

fourth_time_result <- fourth_timers_cats %>%
  group_by(DCNumber) %>%
  mutate(crimes_categories = paste(crime_category, collapse = "; ")) %>%
  select(-crime_category) %>%
  unique()

fourth_time_result_counts <- fourth_time_result %>%
  separate_rows(crimes_categories, sep = "; ") %>%
  count(DCNumber, crimes_categories) %>%
  pivot_wider(names_from = crimes_categories, values_from = n, values_fill = 0)

result_fourth_timers <- data.frame(Category = character(0), Proportion = numeric(0))
categories <- colnames(fourth_time_result_counts)[-1]
for (category in categories) {
  num_associated_rows <- fourth_time_result_counts %>%
    filter(get(category) > 0) %>%
    nrow()
  proportion <- round(num_associated_rows / nrow(fourth_time_result_counts), 3)
  result_fourth_timers <- rbind(result_fourth_timers, data.frame(Category = category, Percent = proportion * 100))
}
```

### Fifth Timers
```{r}
fifth_timers <- times_in %>% filter(times_in == 5)
fifth_timers_crimes <- merge(fifth_timers[, 1], Offenses_CPS %>% select(DCNumber, adjudicationcharge_descr), by = 'DCNumber')
fifth_timers_cats <- merge(fifth_timers_crimes, crimes_categories, by = 'adjudicationcharge_descr') %>% select(DCNumber, crime_category)

fifth_time_result <- fifth_timers_cats %>%
  group_by(DCNumber) %>%
  mutate(crimes_categories = paste(crime_category, collapse = "; ")) %>%
  select(-crime_category) %>%
  unique()

fifth_time_result_counts <- fifth_time_result %>%
  separate_rows(crimes_categories, sep = "; ") %>%
  count(DCNumber, crimes_categories) %>%
  pivot_wider(names_from = crimes_categories, values_from = n, values_fill = 0)

result_fifth_timers <- data.frame(Category = character(0), Proportion = numeric(0))
categories <- colnames(fifth_time_result_counts)[-1]
for (category in categories) {
  num_associated_rows <- fifth_time_result_counts %>%
    filter(get(category) > 0) %>%
    nrow()
  proportion <- round(num_associated_rows / nrow(fifth_time_result_counts), 3)
  result_fifth_timers <- rbind(result_fifth_timers, data.frame(Category = category, Percent = proportion * 100))
}
```

### Six or More
```{r}
six_or_more_timers <- times_in %>% filter(times_in >= 6)
six_or_more_timers_crimes <- merge(six_or_more_timers[, 1], Offenses_CPS %>% select(DCNumber, adjudicationcharge_descr), by = 'DCNumber')
six_or_more_timers_cats <- merge(six_or_more_timers_crimes, crimes_categories, by = 'adjudicationcharge_descr') %>% select(DCNumber, crime_category)

six_or_more_time_result <- six_or_more_timers_cats %>%
  group_by(DCNumber) %>%
  mutate(crimes_categories = paste(crime_category, collapse = "; ")) %>%
  select(-crime_category) %>%
  unique()

six_or_more_time_result_counts <- six_or_more_time_result %>%
  separate_rows(crimes_categories, sep = "; ") %>%
  count(DCNumber, crimes_categories) %>%
  pivot_wider(names_from = crimes_categories, values_from = n, values_fill = 0)

result_six_or_more_timers <- data.frame(Category = character(0), Proportion = numeric(0))
categories <- colnames(six_or_more_time_result_counts)[-1]
for (category in categories) {
  num_associated_rows <- six_or_more_time_result_counts %>%
    filter(get(category) > 0) %>%
    nrow()
  proportion <- round(num_associated_rows / nrow(six_or_more_time_result_counts), 3)
  result_six_or_more_timers <- rbind(result_six_or_more_timers, data.frame(Category = category, Percent = proportion * 100))
}
```

  </p>
  </details>
  </li>
</ul>

```{r code_folding = TRUE}
ordered_first_timers <- result_first_timers %>% arrange(Category)
ordered_second_timers <- result_second_timers %>% arrange(Category)
ordered_third_timers <- result_third_timers %>% arrange(Category)
ordered_fourth_timers <- result_fourth_timers %>% arrange(Category)
ordered_fifth_timers <- result_fifth_timers %>% arrange(Category)
ordered_six_more_timers <- result_six_or_more_timers %>% arrange(Category)
pros_across_times <- cbind(ordered_first_timers,
                           ordered_second_timers[2],
                           ordered_third_timers[2],
                           ordered_fourth_timers[2],
                           ordered_fifth_timers[2],
                           ordered_six_more_timers[2])
new_column_names <- c("Crime Category", "First Commit.", "Second Commit.", "Third Commit.", "Fourth Commit.", "Fifth Commit.", "Sixth Commit.")
names(pros_across_times) <- new_column_names
```

## Proportions of Crime Category by Number of Prison Commitments, Currently Incarcerated FDOC
```{r code_folding = TRUE}
kable(pros_across_times) %>% 
  kable_styling(latex_options = "hold_position")
```

Okay, so among those currently incarcerated for their first commitment, 4.6% of them have Abuse/Neglect crimes associated with their current incarceration. However, this percentage drops to 2.2% for those serving time for their second incarceration. Furthermore, we see a further decrease to 1.9% across the population of those who are serving their third sentence in FDOC, and so on.

Today was a lot of work. I'm taking the rest of the day off and will work on making this information more easily understandable later.


