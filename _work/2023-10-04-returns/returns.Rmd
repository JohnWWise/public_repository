---
title: "FDOC Reincarceration"
description: |
  This document is an ongoing investigation into the data available reincarcerations in Florida. I choose not to use the term "recidivism", as the term implies a focus on reoffending and the idea of a "criminal" identity, rather than acknowledging the complex social, economic, and systemic factors at play.
output:
  distill::distill_article:
    toc: true
    toc_float: true
    toc_depth: 2
    df_print: paged
---
The Florida Department of Corrections makes its OBIS database accessible for public download [here](https://fdc.myflorida.com/pub/obis_request.html).

This document is an ONGOING mining of that data. Keep an eye out for my newsletter (which doesnâ€™t exist yet) for updates, or press f5 to refresh.

<ul>
    <li>
      <details>
        <summary>Importing libraries, setting seed</summary>
        <p>
```{r libraries and seed, echo=TRUE}
# Packages utilized:
pkgs = c("readxl",
         "dplyr",
         "DT",
         "ggforce",
         "kableExtra",
         "viridis",
         "boot",
         "gridExtra")
inst = lapply(pkgs, library, character.only = TRUE)
set.seed(8675309)
```
  </p>
  </details>
  </li>
</ul>

<ul>
    <li>
      <details>
        <summary>Importing Data, Identifying Population for Analysis</summary>
        <p>
```{r}
base_dir <- "/Users/johnwise/Downloads"
Root <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"))
Incarhist <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"), sheet = 6)

first_timers <- Incarhist %>%
  arrange(DCNumber, desc(ReceiptDate)) %>%
  group_by(DCNumber) %>%
  mutate(row_num = row_number()) %>%
  filter(row_num <= 2) %>%
  select(-row_num) %>%
  count(DCNumber) %>%
  filter(n==1)
```
Remove first-timers from analysis
```{r}
returners <- anti_join(Incarhist, first_timers, by ='DCNumber')
# grab the two most recent receipts of those who have returned
returners_current_and_last <- returners %>%
  arrange(DCNumber, desc(ReceiptDate)) %>%
  group_by(DCNumber) %>%
  mutate(row_num = row_number()) %>%
  filter(row_num <= 2) %>%
  select(-row_num)
```
Calcualte time total time served for each person prior to most recent incarceration
```{r}
served_prior <- returners %>%
  mutate(time_served = ifelse(!is.na(ReleaseDate), as.numeric(difftime(ReleaseDate, ReceiptDate, units = "days")), NA)) %>%
  group_by(DCNumber) %>%
  summarize(prev_TimeServed = sum(time_served, na.rm = TRUE))
```
Discovering the amount of time each person was free last time they were out
```{r}
returners_time_free <- returners_current_and_last %>%
  group_by(DCNumber) %>%
  summarise(TimeOut = as.numeric(difftime(max(ReceiptDate, na.rm = TRUE), max(ReleaseDate, na.rm = TRUE), units = "days"))) %>% # Note, there were 7 entires for which a negative time free was calculated. Investigation shows
  filter(TimeOut >= 0) # that this is due to these individuals having missing most ReceiptDate for most recent conviction.
# We omit these 7 observations for the purpose of this analysis
```
Determining how many times each person has been incarcerated
```{r}
times_in <- returners %>%
  group_by(DCNumber) %>%
  summarize(times_in = n())
```

Going back to fetch general information on those identified, compiling with calculated values
```{r}
returners_a <- merge(merge(merge(Root, returners_time_free, by = 'DCNumber'), served_prior, by = 'DCNumber'), times_in, by = 'DCNumber')
```
Removing outlier
```{r}
# Not sure why the FDOC has the individual with DC Number 872984 as initially coming to prison on 1901-01-01, but we will omit this individual from our analyses as well.
returners_a <- returners_a[-which(returners_a['DCNumber']=='872984'),]
# Create the 'times_in_bins' column
returners_a$times_in_bins <- cut(returners_a$times_in,
                                 breaks = c(2, 3, 4, 6, 17),
                                 labels = c("2 bids", "3 bids", "4-6 bids", "6-17 bids"),
                                 include.lowest = TRUE)

# Create the 'prev_TimeServed_bins' column
breaks <- c(0, 1, 3, 5, 10, 25, 50)
labels <- c("0-1 Years", "1-3 Years", "3-5 Years", "5-10 Years", "10-25 Years", "25-50 Years")
returners_a$prev_TimeServed_bins <- cut(returners_a$prev_TimeServed / 365.25,
                                       breaks = breaks,
                                       labels = labels,
                                       include.lowest = TRUE)
```

  </p>
  </details>
  </li>
</ul>


# Inital Look

```{r code_folding = TRUE}
prop_returned <- round(dim(returners_a)[1]/dim(Root)[1],2)
mean_incarcerations <- round((sum(returners_a$times_in) + dim(first_timers)[1])/dim(Root)[1],2)
```

```{r fig.align = TRUE, code_folding = TRUE}
new_data <- data.frame(times_in_bins = rep("First Bid", 44300))

combined_data <- rbind(returners_a %>% select(times_in_bins), new_data)

ggplot(combined_data, aes(x = "", fill = times_in_bins)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = c("#008080", "#336673", "#664C66", "#993359", "#CC194C", "#FF0040")) +
  theme_void() +  # Remove axis and grid lines
  labs(title = "Times Incarcerated, Currently Incarcerated FDOC Population")
```

Amazingly, a full `r prop_returned * 100`% of our currently incarceratd population has served time previously. FDOC likes returning customers, I've heard them say so myself.

Indeed, the average number of times a person has been incarcerated across the entire population is `r mean_incarcerations`. In other words, the average person currently incarcerated in FDOC has been incarcerated more than 2 times before. What does this imply for the argument of incarceration as a deterrent?

If you were to purchase an item from a store where the average item on the shelf had been returned at least twice, would it be reasonable to feel frustrated with *the item* if it later turns out to be faulty? Personally I just wouldn't shop there anymore.

## Time Free Since Last Release
Next, we should examine the amount of time that those who are currently incarcerated in Florida were free since their last incarceration:

```{r fig.align='center', fig.height=5, fig.width=10, code_folding = TRUE}
quartiles <- round(quantile(returners_a$TimeOut, probs = c(0.25, 0.5, 0.75))/365.25, 1)

color_palette <- c("#008080", "#336673" ,"#664C66", "#993359", "#CC194C", "#FF0040")



# Create the first plot (plota)
plota <- ggplot(returners_a, aes(x = 1, y = TimeOut / 365.25, color = prev_TimeServed_bins, group = 1)) +
  geom_sina(alpha = 0.5, position = 'dodge') +
  scale_color_manual(values = color_palette, name = 'Served') +
  ylab("Years Free") +
  theme_minimal() +
  theme(panel.grid.major.x = element_blank()) +
  labs(title = "Years Free, Colored by Previous Fl. Time Served")


color_palette <- c("#008080", "#336673", "#CC194C", "#FF0040")
# Create the second plot (plotb)
plotb <- ggplot(returners_a, aes(x = 1, y = TimeOut / 365.25, color = times_in_bins, group = 1)) +
  geom_sina(alpha = 0.5) +
  scale_color_manual(values = color_palette, name = 'Number of Bids') +
  ylab(NULL) +
  theme_minimal() +
  labs(title = "Years Free, Colored by Number of Incarcerations")

# Customize plot margins for both plots
plota <- plota + theme(plot.margin = margin(0, 0, 0, 0, unit = "pt"))
plotb <- plotb + theme(plot.margin = margin(0, 0, 0, 0, unit = "pt"))

# Arrange the plots using grid.arrange
grid.arrange(plota, plotb, ncol = 2)
```

We can observe that the majority of individuals who are currently incarcerated in Florida, and who have a previous history of incarceration, did not have a significant period of freedom before their current imprisonment. Interestingly, we also notice a pattern where individuals who had served long sentences in the past or multiple sentences were not able to remain free for long before being incarcerated again. This is evident from the redder points towards the bottom of the visuals. This result may be surprising to those unfamiliar with the experience of being incarcerated, the assumption being that with effective correctional measures the longer one serves inside or the more times one is sentenced to prison, the more equipped they would be to stay out longer and remain free. I don't expect many to be surprised, however, that we here see evidence that the *longer one is inside the less equipped one is* to navigate the obstacles which await. We continue to investigate.


```{r fig.align = 'center', code_folding = TRUE}
ggplot(returners_a, aes(x = prev_TimeServed/365.25, y = TimeOut/365.25)) +
  geom_point(color = 'blue', alpha = 0.5, size = 3) +
  geom_smooth(method = 'lm', color = 'red', se = FALSE) +
  labs(title = "Correlation between Previous Time Served and Time Out",
       x = "Previous Time Served (Years)",
       y = "Time Out Bewteen Last Bid(Years)") + 
  theme_minimal() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title = element_text(size = 14),
        axis.text = element_text(size = 12),
        plot.title = element_text(size = 16, hjust = 0.5),
        legend.position = "none") 
```

And above we have additional visual evidence that the longer one spends incarcerated, the less one is able to avoid reincarceration.

Let's apply statistical rigor to this matter.

```{r code_folding = TRUE}
# Define the data for bootstrapping
data_for_bootstrap <- data.frame(prev_TimeServed = returners_a$prev_TimeServed, TimeOut = returners_a$TimeOut)

# Function to obtain the slope of the regression line from bootstrapped samples
slope_fn <- function(data, indices) {
  sample_data <- data[indices, ]
  lm_result <- lm(TimeOut ~ prev_TimeServed, data = sample_data)
  coef(lm_result)[2]  # Extract the slope coefficient
}

# Perform bootstrapping with 1000 resamples
bootstrap_results <- boot(data_for_bootstrap, slope_fn, R = 1000)

# Calculate the p-value from the bootstrapped distribution
slope_estimate <- mean(bootstrap_results$t)
slope_se <- sd(bootstrap_results$t)
p_value <- 2 * min(sum(bootstrap_results$t <= 0), sum(bootstrap_results$t >= 0)) / length(bootstrap_results$t)
```

```{r}
cat("Bootstrap Slope Estimate:", slope_estimate, "\n")
cat("95% Confidence Interval for Slope:", quantile(bootstrap_results$t, c(0.025, 0.975)), "\n")
cat("p-value:", p_value, "\n")
```
To translate, we have exceptionally compelling statistical evidence that shows a very strong correlation between the duration of incarceration and the likelihood of being re-incarcerated. Based on the experiences of currently incarceratd population of Florida prisons, each year spent behind bars is associated with a decrease of approximately 6 weeks in their expected time until re-incarceration.

### Time Free

```{r code_folding = TRUE}
quartile_table <- data.frame(
  "Quartile" = c("Q1", "Median (Q2)", "Q3"),
  Years_Free = quartiles
)

kable(quartile_table) %>% 
  kable_styling(latex_options = "hold_position")

```


We frequently encounter statistics that state "X amount of Florida prisoners will return within 5 years." However, a more appropriate way to present this information is to focus on the current incarcerated population in Florida who have served time before. Shockingly, a quarter of them were returned to prison in less than 1.8 years after their most recent release, while half of them were not out longer than 3.2 years. Moreover, only 25% of them managed to stay out of prison for more than 5.7 years.

This subtle change in framing emphasizes the inefficiency of traditional carceral structures in preventing recidivism, while also highlighting the responsibility of the correctional agency. If the purpose of a sentence is to 'correct,' why do we frequently find the need to re-correct so soon?


## County of most Recent Commitment


## Charges


# Returns Less than 1 Year

```{r Isolating those out less than one year on most recent release, code_folding = TRUE}
short_out <- returners_time_free %>%
  filter(TimeOut <= 365)
```

