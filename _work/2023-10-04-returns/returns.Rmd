---
title: "FDOC Returns to Incarceration"
description: |
  This document presents an ongoing investigation into returns to incarceration in Florida.
output:
  distill::distill_article:
    toc: true
    toc_float: true
    toc_depth: 2
    df_print: paged
---
The Florida Department of Corrections makes its OBIS database accessible for public download [here](https://fdc.myflorida.com/pub/obis_request.html).

This document is an ongoing mining of that data. Keep an eye out for my newsletter (which doesn't exist yet) for updates, or press F5 to refresh.

<ul>
    <li>
      <details>
        <summary>Importing libraries, setting seed</summary>
        <p>
```{r libraries and seed, echo=TRUE}
# Packages utilized:
pkgs = c("readxl",
         "dplyr",
         "ggforce",
         "kableExtra",
         "gridExtra",
         "DT")
inst = lapply(pkgs, library, character.only = TRUE)
set.seed(8675309)
```
  </p>
  </details>
  </li>
</ul>

<ul>
    <li>
      <details>
        <summary>Importing Data, Preprocessing and Cleaning</summary>
        <p>
Importing
```{r}
base_dir <- "/Users/johnwise/Downloads"
Root <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"))
Incarhist <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"), sheet = 6)
Offenses_CPS <- read_excel(paste0(base_dir, "/Inmate_Active_2023-10.XLSX"), sheet = 4)
```
Isolating first-timers
```{r}
first_timers <- Incarhist %>%
  arrange(DCNumber, desc(ReceiptDate)) %>%
  group_by(DCNumber) %>%
  mutate(row_num = row_number()) %>%
  filter(row_num <= 2) %>%
  select(-row_num) %>%
  count(DCNumber) %>%
  filter(n==1)

returners <- anti_join(Incarhist, first_timers, by ='DCNumber')
# grab the two most recent receipts of those who have returned
returners_current_and_last <- returners %>%
  arrange(DCNumber, desc(ReceiptDate)) %>%
  group_by(DCNumber) %>%
  mutate(row_num = row_number()) %>%
  filter(row_num <= 2) %>%
  select(-row_num)
```
Calculate total time served for each person prior to most recent incarceration
```{r}
served_prior <- returners %>%
  mutate(time_served = ifelse(!is.na(ReleaseDate), as.numeric(difftime(ReleaseDate, ReceiptDate, units = "days")), NA)) %>%
  group_by(DCNumber) %>%
  summarize(prev_TimeServed = sum(time_served, na.rm = TRUE))
```
Discovering the amount of time each returned person was free last time they were out
```{r}
returners_time_free <- returners_current_and_last %>%
  group_by(DCNumber) %>%
  summarise(TimeOut = as.numeric(difftime(max(ReceiptDate, na.rm = TRUE), max(ReleaseDate, na.rm = TRUE), units = "days"))) %>% # Note, there were 7 entires for which a negative time free was calculated. Investigation shows
  filter(TimeOut >= 0) # that this is due to these individuals having missing most ReceiptDate for most recent conviction.
# We omit these 7 observations for the purpose of this analysis
```
Determining how many times each person has been incarcerated
```{r}
times_in <- returners %>%
  group_by(DCNumber) %>%
  summarize(times_in = n())
```
Going back to fetch general information on those isolated, compiling with calculated values
```{r}
returners_a <- merge(merge(merge(Root, returners_time_free, by = 'DCNumber'), served_prior, by = 'DCNumber'), times_in, by = 'DCNumber')
```
Removing outlier, binning data
```{r}
# Not sure why the FDOC has the individual with DC Number 872984 as initially coming to prison on 1901-01-01, 
#but we will omit this individual from our analyses as well.
returners_a <- returners_a[-which(returners_a['DCNumber']=='872984'),]

# Create the 'times_in_bins' column
returners_a$times_in_bins <- cut(returners_a$times_in,
                                 breaks = c(2, 3, 4, 6, 17),
                                 labels = c("2 bids", "3 bids", "4-6 bids", "6-17 bids"),
                                 include.lowest = TRUE)

# Create the 'prev_TimeServed_bins' column
breaks <- c(0, 1, 3, 5, 10, 25, 50)
labels <- c("0-1 Years", "1-3 Years", "3-5 Years", "5-10 Years", "10-25 Years", "25-50 Years")
returners_a$prev_TimeServed_bins <- cut(returners_a$prev_TimeServed / 365.25,
                                       breaks = breaks,
                                       labels = labels,
                                       include.lowest = TRUE)
```

  </p>
  </details>
  </li>
</ul>


# Inital Look
```{r fig.align = 'center', code_folding = TRUE}
prop_returned <- round(dim(returners_a)[1]/dim(Root)[1],2)
mean_incarcerations <- round((sum(returners_a$times_in) + dim(first_timers)[1])/dim(Root)[1],2)

new_data <- data.frame(times_in_bins = rep("First Bid", dim(first_timers)[1]))
combined_data <- rbind(returners_a %>% select(times_in_bins), new_data)
ggplot(combined_data, aes(x = "", fill = times_in_bins)) +
  geom_bar(width = 1, stat = "count") +
  coord_polar("y", start = 0) +
  scale_fill_manual(values = c("#2c7bb6", "#abd9e9" ,"#ffffbf", "#fdae61", "#e6e6e6", "#7f3b00")) +
  theme_void() +  # Remove axis and grid lines
  labs(title = "Times Incarcerated, Currently Incarcerated FDOC Population")
```

Amazingly, a full `r prop_returned * 100`% of our currently incarcerated population has served time previously. The Florida Department of Corrections (FDOC) seems to appreciate repeat customers; I've heard them say so myself.
Furthermore, the average number of times a person has been incarcerated across the entire population is `r mean_incarcerations`. In other words, the average person currently incarcerated in FDOC has been incarcerated more than twice before.
What does this information imply about the argument for incarceration as a deterrent?

Regarding the argument on incarceration as a deterrent, I pose this question: How many crimes has the threat of incarceration prevented YOU from committing?

If your answer is "none," then you are likely in the majority. 

If your response is "none, but I'm not a criminal," then it is worth reflecting on the following: Who are the criminals? What do they look like? Where do they come from? Which neighborhoods do they reside in? How comfortable are you with your answers?

## Time Free Since Last Release

Next, we should examine the amount of time that those who are currently incarcerated in Florida were free in between their current and their last incarceration:

```{r fig.align='center', fig.height=5, fig.width=10, code_folding = TRUE}
quartiles <- round(quantile(returners_a$TimeOut, probs = c(0.25, 0.5, 0.75))/365.25, 1)

color_palette <- c("#ffffff", "#e6e6e6", "#bfbfbf", "#808080", "#404040", "#000000")



# Create the first plot (plota)
plota <- ggplot(returners_a, aes(x = 1, y = TimeOut / 365.25, color = prev_TimeServed_bins, group = 1)) +
  geom_sina(alpha = 0.5, position = 'dodge') +
  geom_violin(alpha = 0.1, color = "black") +
  scale_color_manual(values = color_palette, name = 'Served') +
  ylab("Years Free") +
  theme_void() +  # Remove axis and grid lines
  theme(axis.text.y = element_text()) +  # Keep y-axis labels
  labs(title = "Years Free, Shaded by Previous Fl. Time Served")


color_palette <- c("#ffffff", "#e6e6e6", "#404040", "#000000")

# Create the second plot (plotb)
plotb <- ggplot(returners_a, aes(x = 1, y = TimeOut / 365.25, color = times_in_bins, group = 1)) +
  geom_sina(alpha = 0.5) +
  geom_violin(alpha = 0.1, color = "black") +
  scale_color_manual(values = color_palette, name = 'Number of Bids') +
  ylab(NULL) +
  theme_void() +  # Remove axis and grid lines
  theme(axis.text.y = element_text()) +  # Keep y-axis labels
  labs(title = "Years Free, Shaded by Number of Incarcerations")

# Customize plot margins for both plots
plota <- plota + theme(plot.margin = margin(0, 0, 0, 0, unit = "pt"))
plotb <- plotb + theme(plot.margin = margin(0, 0, 0, 0, unit = "pt"))

# Arrange the plots using grid.arrange
grid.arrange(plota, plotb, ncol = 2)
```

We can observe that the majority of individuals who are currently incarcerated in Florida, and who have a previous history of incarceration, did not have a significant period of freedom before their current imprisonment. Interestingly, we also notice a pattern where individuals who had served long sentences in the past or multiple sentences were not able to remain free for long before being incarcerated again. This is evident from the darker points towards the bottom of the visuals. This result may be surprising to those unfamiliar with the experience of being incarcerated, as the assumption is that with effective correctional measures, the longer one serves inside or the more times one is sentenced to prison, the more equipped they would be to stay out longer and remain free. I don't expect many to be surprised, however, that we see evidence here that the *longer one is inside, the less equipped one is* to navigate the obstacles that await.

### Time Free

```{r code_folding = TRUE}
quartile_table <- data.frame(
  "Quartile" = c("Q1", "Median (Q2)", "Q3"),
  Years_Free = quartiles
)

kable(quartile_table) %>% 
  kable_styling(latex_options = "hold_position")

```


We frequently encounter statistics that state "X amount of Florida prisoners will return within 5 years." However, a more appropriate way to present this information is to focus on the current incarcerated population in Florida who have served time before. Shockingly, a quarter of them were returned to prison in less than 1.8 years after their most recent release, while half of them were not out longer than 3.2 years. Moreover, only 25% of them managed to stay out of prison for more than 5.7 years.
This subtle change in framing emphasizes the inefficiency of traditional carceral structures in preventing recidivism while also highlighting the responsibility of the correctional agency. If the purpose of a sentence is to 'correct,' why do we frequently find the need to re-correct so soon?

# Charges

For each person who is currently incarcerated and has at least one prior incarceration, we have data on all adjudications for their current and past incarcerations.
Regarding those currently incarcerated, we observe that they are serving time for a wide range of adjudication charges. There are 863 different charges for which these individuals are currently incarcerated.

```{r}
returners_hist <- merge(returners_a, Offenses_CPS, by = 'DCNumber')
returners_hist$adjudicationcharge_descr <- as.factor(returners_hist$adjudicationcharge_descr)

charges <- returners_hist %>%
  group_by(adjudicationcharge_descr) %>%
  summarize(charge_count = n()) %>%
  arrange(desc(charge_count))
charges
```
We need approximately 6-12 crime categories for our analysis. Currently, my task is to consolidate them into a smaller set of groups that we can work with. Although it's a tedious task that I've been procrastinating on, I hope to complete it soon and continue with the analysis.

<ul>
    <li>
      <details>
        <summary>Forming Categories</summary>
        <p>
### Burglary and Theft
```{r code_folding = TRUE}
burglary_theft_keywords <- c(
  "BURGLARY",
  "BURGUNOCCSTRUC",
  "THEFT",
  "BURGL",
  "BREAK-IN",
  "STOLEN PROPERTY",
  "LARCENY",
  "BURGLARY TOOLS",
  "GRAND THEFT MOTOR VEHICLE",
  "RETAIL THEFT",
  "THEFT COPPER/NONFER.METALS",
  "GRAND THEFT W/DAMAGE",
  "SELL/ETC UNNUMBERED AUTO",
  "ORG RETAIL THEFT > 3K",
  "THEFT>65YO>$300<$10K",
  "BURG/DWELL/OCCUP.CONVEY",
  "BURG/N/ASSLT/OCC.STRUCT",
  "BURG/TREPASS",
  "PURSE",
  "STOLEN VEHICLE",
  "GT",
  "BURG.-STRUCT"
)
```
### Drug Offenses
```{r code_folding = TRUE}
drug_offenses_keywords <- c(
  "DRUG",
  "BARBITURATE-POSSESS",
  "NARCOTIC",
  "COCAINE",
  "COC.",
  "MANUFAC. POSS W",
  "MARIJUANA",
  "IMIT.CON.SUBS.",
  "HEROIN",
  "GHB",
  "10GR.HER.SCH.I",
  "SCH I & II",
  "MINOR-BATHSALTS",
  "METHAMPHETAMINE",
  "PRESCRIPTION FRAUD",
  "DRUG PARAPHERNALIA",
  "CONTROLLED SUBSTANCE",
  "POSSESSION OF CONTROLLED SUBSTANCE",
  "POSSESSION OF DRUG PARAPHERNALIA",
  "DRUG DISTRIBUTION",
  "POSSESSION OF NARCOTICS",
  "EPHEDRINE",
  "CONTRL.SUBST.",
  "POSSESSION OF METHAMPHETAMINE",
  "DRUG TRAFFICKING WITHIN 1000 FT OF SCHOOL",
  "POSSESSION OF COCAINE",
  "POSSESSION OF HEROIN",
  "POSSESSION OF MARIJUANA",
  "SELLING DRUGS",
  "TRANSPORTATION OF CONTROLLED SUBSTANCE",
  "POSSESSION WITH INTENT TO DISTRIBUTE",
  "DRUG ABUSE",
  "DRUG TRAFFICKING W/INTENT TO SELL",
  "FELONY POSSESSION OF CONTROLLED SUBSTANCE",
  "HALLUCINOGEN-OTHER-NON MARIJ",
  "CONSTRUCTIVE POSSESSION",
  "METH",
  "POSS.CONTROL.SUBS/OTHER",
  "POSS/DIST.CHEM.TO MFG.SUB",
  "DRUGS",
  "SALE MAR.ETC",
  "SELL/ETC/COC/HER/1K",
  "AMPHETAMINE-PUR/POSS/W/INT",
  "AMPHETAMINE-POSSESS",
  "AMPHETAMINE",
  "TRAFF",
  "BARBITUATE",
  "CONTR.SUBST.",
  "CON.SUBST.",
  "CONT.SUB",
  "OPIUM",
  "POS PLAC MAN SUB/MINOR EXIST",
  "S/M/D",
  "MARIJ",
  "DEAL DRGS",
  "DEAL/ETC.MAJR.DRG",
  "SYN.NARC",
  "SMD",
  "MDMA",
  "ROHYPNL",
  "OWN/RENT STRUC/CONV TRAF/MAN",
  "MARIJ/LSD-SALE/DEL.TO",
  "DIST.OF NIT.OX.",
  "INJECT/INHALE"
)
```

### Violent Crimes
```{r code_folding = TRUE}
violent_crimes_keywords <- c(
  "HOMICIDE",
  "MURDER",
  "CARJACK",
  "MANSLAUGHTER",
  "ASSAULT",
  "AGGRAVATED ASSAULT",
  "BATTERY",
  "ROBBERY",
  "KIDNAPPING",
  "SEXUAL ASSAULT",
  "SEXUAL BATTERY",
  "RAPE",
  "ARSON",
  "DOMESTIC VIOLENCE",
  "CARJACKING",
  "ARMED ROBBERY",
  "AGGRAVATED BATTERY",
  "AGGRAVATED RAPE",
  "AGGRAVATED SEXUAL ASSAULT",
  "AGGRAVATED DOMESTIC VIOLENCE",
  "AGGRAVATED CARJACKING",
  "ATTEMPTED MURDER",
  "SER.INJ/FRM",
  "AGGRAVATED ARSON",
  "AGGRAVATED KIDNAPPING",
  "AGGRAVATED BURGLARY",
  "CRIMINAL HOMICIDE",
  "ASSAULT WITH A DEADLY WEAPON",
  "ASSAULT ON A LAW ENFORCEMENT OFFICER",
  "ARMED ASSAULT",
  "CHILD ABDUCTION",
  "GUNSHOT WOUND",
  "STABBING",
  "FIREARM POSSESSION",
  "AGGRAVATED BATTERY WITH A DEADLY WEAPON",
  "ROBB.",
  "2ND DEG.MURD",
  "MURD",
  "AGG ASSLT-W/WPN",
  "BATT.LEO/FIRFGT/EMS/ETC.",
  "BATT.",
  "ASSLT-INTENT",
  "AGGRAV ASSLT-NONFAMILY-GUN",
  "KIDNAP;COMM.OR FAC.FELONY",
  "MUR/PREMED",
  "AGGRAV ASSLT",
  "KIDNAP",
  "FORCIBLE",
  "FALS.IMPRSN-NO",
  "AGGRAV ASSLT",
  "AGG.ASSLT/LEO/FIREFGT/EMS/ETC.",
  "MUR,COM.OF",
  "IMPRISON",
  "HARMS PUBLIC SERVANT",
  "DISCHARGE F/A FR.VEHICLE W/I 1",
  "MANSL",
  "DOM VIO",
  "BOD.INJ./NOT"
)
```

### Sex Crimes
```{r code_folding = TRUE}
sex_crimes_keywords <- c(
  "SEXUAL",
  "SEX",
  "RAPE",
  "AGGRAVATED RAPE",
  "AGGRAVATED SEXUAL ASSAULT",
  "SEX OFFENSE",
  "INCEST",
  "INDECENT EXPOSURE",
  "CHILD PORNOGRAPHY",
  "CHILD SEXUAL ABUSE",
  "STATUTORY RAPE",
  "ADLT/CUST VID",
  "SEXUAL HARASSMENT",
  "FORCIBLE SODOMY",
  "LEWD AND LASCIVIOUS CONDUCT",
  "SEXUAL EXPLOITATION",
  "CHILD MOLESTATION",
  "SEXUAL MISCONDUCT",
  "SEXUAL EXPLOITATION OF A MINOR",
  "INDECENT ACT WITH A CHILD",
  "SEXUAL PREDATOR",
  "FORCED SEX",
  "VOYEURISM",
  "NONCONSENSUAL SEX",
  "SEXUAL ABUSE OF A MINOR",
  "GROOMING A MINOR FOR SEXUAL EXPLOITATION",
  "SOLICITATION OF A MINOR FOR SEXUAL CONDUCT",
  "ONLINE SEXUAL ENTICEMENT OF A MINOR",
  "CHILD SEX TRAFFICKING",
  "PROSTITUTION",
  "PROSTITUTION RING",
  "PIMPING",
  "SEX TRAFFICKING",
  "INDECENT ASSAULT",
  "UNLAWFUL SEXUAL INTERCOURSE",
  "AGGRAVATED INDECENT ASSAULT",
  "FORCED PROSTITUTION",
  "FORCED SEXUAL SERVITUDE",
  "MOLEST",
  "L/L",
  "PROV.OBSCENE MAT.MINOR",
  "L&L",
  "IMPREG.GRL",
  "CRIM.SOLIT.CHILD",
  "TRFC:SX",
  "FORCE TO BECOME PROSTITUTE",
  "PROCURE FOR",
  "CHILD PORN.",
  "PROST",
  "LEWD",
  "TFK:LABOR",
  "LURE CHILD",
  "MINOR SX MATERIAL"
)
```

### Crimes of Incarceration
```{r code_folding = TRUE}
incarceration_related_crimes <- c(
  "ESCAPE",
  "INTRODUCTION OF CONTRABAND",
  "ASSAULT ON STAFF",
  "PRISON RIOT",
  "INTRO.INTOXICATING",
  "CONTR.SUB.INTO",
  "INMATE ON INMATE ASSAULT",
  "UNAUTHORIZED POSSESSION OF WEAPONS",
  "RIOTING IN A CORRECTIONAL FACILITY",
  "ATTEMPTED ESCAPE",
  "CONTRABAND TRAFFICKING",
  "INMATE MUTINY",
  "LEO",
  "FAIL.TO",
  "PRISON",
  "UNAUTH. COMP. ACCESS",
  "STAFF-ON-INMATE ASSAULT",
  "STAFF INVOLVEMENT IN CONTRABAND SMUGGLING",
  "INMATE EXTORTION",
  "COMPLY PSIA",
  "BY FELON",
  "FEL/DELI W/GUN/CONC WPN/AMMO",
  "CO DET FAC",
  "FAILURE TO APPEAR",
  "CONTRABAND-PRISON",
  "INTRODUCE",
  "CONTRABAND",
  "DETENTN FAC",
  "APPEAR/FEL.BAIL",
  "REGISTER-CAREER CRIM",
  "RESISTING OFFICER W/VIOLEN.",
  "FLEE",
  "OFFENDER",
  "INTRODUCING",
  "PRISONERS",
  "FAIL TO REGISTER",
  "REGISTR.VIOL.",
  "DAMAGE ELEC.MONITOR.EQUIP.",
  "RIOT",
  "2-WAY COMM.",
  "CORRECTION STAFF",
  "RESIST.LEO",
  "NOTIF.SHERIFF",
  "BRING INTO STA/CONTR SUBST",
  "EXCON",
  "DETAINEE",
  "GANG MEMBERSHIP",
  "RE SX.OFNDR.",
  "OFFICIAL/EMPLOYEE",
  "MISD. TO FEL.BY GANG MEMBR",
  "BENEFIT GANG",
  "PREVIOUS CONVICT",
  "VLNT.CAREER CRIM.POSS.GUN",
  "CONTRAB."
)
```

### Property Crimes
```{r code_folding = TRUE}
property_crimes <- c(
  "ARSON",
  "VANDALISM",
  "TRESPASSING",
  "SHOPLIFTING",
  "MOTOR VEHICLE THEFT",
  "LARCENY",
  "CRIMINAL DAMAGE TO PROPERTY",
  "RECEIVING STOLEN PROPERTY",
  "BURGLARY OF A VEHICLE",
  "PETTY THEFT",
  "OFFERS FOR SALE",
  "GRAND THEFT",
  "IDENTITY THEFT",
  "EMBEZZLEMENT",
  "FRAUD",
  "FORGERY",
  "OBTAIN GOODS",
  "CREDIT CARD FRAUD",
  "CHECK FRAUD",
  "MAIL THEFT",
  "BICYCLE THEFT",
  "SHOPPING CART THEFT",
  "VEHICLE PARTS THEFT",
  "BUILDING BREAKING AND ENTERING",
  "CRIMINAL TRESPASS",
  "CRIMINAL MISCHIEF",
  "GRAFFITI",
  "INT./RECKLESS BURN LAND",
  "CRIMINAL TAMPERING",
  "ARSON OF A VEHICLE",
  "LOOTING",
  "HOME INVASION",
  "EXTORTION",
  "STOLEN PROPERTY TRAFFICKING",
  "PROPERTY DAMAGE",
  "VANDALISM OF GOVERNMENT PROPERTY",
  "PROPERTY",
  "SNATCH",
  "DAMAGE PROPERTY-OTHER",
  "FALSE APPL./STATE.",
  "CHOP SHOP",
  "STOLEN CARGO",
  "METAL RECYCLER"
)
```

### White-Collar and Fraud
```{r code_folding = TRUE}
white_collar_fraud_crimes <- c(
  "EMBEZZLEMENT",
  "FRAUD",
  "FORGERY",
  "CREDIT CARD FRAUD",
  "CHECK FRAUD",
  "IDENTITY THEFT",
  "WIRE FRAUD",
  "RACKETEER",
  "INSURANCE FRAUD",
  "MONEY LAUNDERING",
  "SECURITIES FRAUD",
  "TAX EVASION",
  "INSIDER TRADING",
  "BANK FRAUD",
  "COUNTERFEITING",
  "SUPPLY STOLEN/FAKE",
  "CREDIT CARD SKIMMING",
  "AGENT/ISSUE LICENSE REQUIREMEN",
  "PONZI SCHEME",
  "ALTER ID",
  "RACKETEERING",
  "PHISHING",
  "INVESTMENT FRAUD",
  "ONLINE SCAMS",
  "WIRE TRANSFER FRAUD",
  "MAIL FRAUD",
  "TELEMARKETING FRAUD",
  "COUNTERFEIT CURRENCY",
  "COUNTERFEIT GOODS",
  "COUNTERFEIT DOCUMENTS",
  "MORTGAGE FRAUD",
  "OBTAIN PROP",
  "VIN-TITLE-ETC",
  "INTERNET FRAUD",
  "BANKRUPTCY FRAUD",
  "HEALTHCARE FRAUD",
  "PUBLIC CORRUPTION",
  "BID-RIGGING",
  "ANTITRUST VIOLATIONS",
  "ENVIRONMENTAL FRAUD",
  "SECURITIES VIOLATIONS",
  "CIVIL FRAUD",
  "WELFARE FRAUD",
  "BENEFIT FRAUD",
  "GRANT FRAUD",
  "STUDENT LOAN FRAUD",
  "PROPERTY FLIPPING",
  "CREDIT REPAIR SCAMS",
  "FRAUDULENT LOANS",
  "PENSION FUND FRAUD",
  "REAL ESTATE FRAUD",
  "FALSE STATMT",
  "CONSUMER FRAUD",
  "PYRAMID SCHEMES",
  "INTELLECTUAL PROPERTY FRAUD",
  "FORGED",
  "FALS INF. TO",
  "PASS TITLE",
  "CONTERFEIT LOTTERY",
  "CHECKS",
  "BRIBERY",
  "LOTTERY",
  "ANTITRUST",
  "UTTERING",
  "FALSE NAME",
  "UNNUMBERED AUTO",
  "FALSE REPORTS",
  "COUNTERFEIT",
  "CREDIT CARD",
  "RECEIV. PROCEEDS",
  "RACKTEERING",
  "LAUNDER",
  "CREDIT",
  "BROKERING",
  "EXPL",
  "FORGE",
  "ODOMETER",
  "FALSE STATEMENT",
  "BRIBES",
  "FALSE CERTIFICATE",
  "MISREPRESENTATION",
  "PRACTICE MEDICINE",
  "NATURO",
  "DEAL STOLEN",
  "EXP ELDER DISABLD",
  "SUBMIT FALSE",
  "MAKING FALSE REPORT",
  "MISAPPRO.FUNDS",
  "UNLAWFUL COMPENSATION",
  "BUY,SELL VESSEL W/ALT.NUM.",
  "CREATE FALSE",
  "DEAL.INS.NO CERTIF/AUTH.",
  "POSS PRSNL ID INF 5+ PERSONS",
  "UNAUTH POSS/USE OF DL/ID",
  "POSS PRSNL ID"
)
```
### Motor Vechile Crimes
```{r code_folding = TRUE}
traffic_crimes <- c(
  "SPEEDING",
  "DRIV.W/O",
  "DRV",
  "TAG-MISD.",
  "VEHICLE",
  "DUI",
  "CRASH",
  "HIT AND RUN",
  "RECKLESS DRIVING",
  "DRUNK DRIVING (DUI/DWI)",
  "DRIVING WITHOUT A LICENSE",
  "DRIVING WITH A SUSPENDED LICENSE",
  "FAILURE TO STOP AT A STOP SIGN",
  "FAILURE TO YIELD THE RIGHT OF WAY",
  "RUNNING A RED LIGHT",
  "DRIVING WITHOUT INSURANCE",
  "LEAVING THE SCENE OF AN ACCIDENT (HIT AND RUN)",
  "TEXTING WHILE DRIVING",
  "DISTRACTED DRIVING",
  "DRIV W/LIC",
  "FAIL STOP CRASH INJ/DEATH",
  "TOW/STORE VEH.VIOL.",
  "UNAUTH USE",
  "DWLSR",
  "DRIVE-BODILY",
  "ILLEGAL LIC PLATE",
  "LEAVE ACCIDENT",
  "DRIVE",
  "BOATING"
  )
```
### Probation Violation/Parole Violation
```{r code_folding = TRUE}
probation_crimes <- c(
  "Probation",
  "Parole",
  "Community custody",
  "Conditional release",
  "Supervised release",
  "Probation breach",
  "Parole breach",
  "violation",
  'FAIL RPT.NONMOVE',
  "ELEC. MON. DEVICE"
)
```

### Abuse/Neglect
```{r code_folding = TRUE}
abuse_neglect_crimes <- c(
  "Abuse",
  "neglect",
  "ABUSE-NEGLECT",
  "NEGLCT"
)

```

### Other Crimes
```{r code_folding = TRUE}
other_crimes <- c("CARRYING CONCEALED FIREARM",
                  "LIQUOR-POSSESSION BY MINOR",
                  "POSSES VEH W/ILL LIC PLATE",
                  "POSS/USE HOX BMB-FLNY/ATT.",
                  "FLEE LEO/NO REGARD",
                  "OBSTRUCT",
                  "IMPRSN.LEO",
                  "PRESCRIBER",
                  "FAILED TO RETURN",
                  "WILLFUL FLEE/ELUDE LEO",
                  "EAPON OFFENSE-OTHER",
                  "DISCH.DESTR.DEVICE",
                  "POSSESS ILLEGAL WEAPON",
                  "MISD. TO FEL. W/PREJUDICE", #I don't know what this is
                  "INTIMIDATE/FORCE WITNESS",
                  "DISCHARGE DESTRUC.DEVICE",
                  "GAMBLING-OTHER",
                  "SEC MET RECYCL 3RD SUB VIO",
                  "CONCEAL CHILD DUR.CUS.PROCEED",
                  "CONCEAL CHILD NON-CUS PARENT",
                  "SEND MINOR HARM.INFO-OTH STATE",
                  "W/H INFO. FROM PRESCRIBER",
                  "MISDEMEANOR",
                  "RAC.HLTHCARE",
                  "OBSCENE MATERIAL-SELL",
                  "INTERFERE W/ RR/EQUIP",
                  "FALSE INFO",
                  "OBSOLETE DATA-BEFORE EST.CODES",
                  "TRESPASS",
                  "ANIMAL CRUELTY",
                  "ENDANG. SPECIES",
                  "PRESCP BLANK",
                  "FAIL TO RETURN RENTED VEH.",
                  "UNKNOWN",
                  "DISCH.WEAP.SCHOOL GROUNDS",
                  "THREATENS",
                  "SHOOT/THROW MISSILE",
                  "PERJURY",
                  "DIRECT PERSON TO DISC. F/A FR.",
                  "ACCESSORY",
                  "AGG.STALK",
                  "JURY TAMPERING",
                  "INTIMIDATION",
                  "AGAINST THE STATE",
                  "WITNESS",
                  "MISUSE OF 911",
                  "TAMPER/COMMAND",
                  "DENTISTRY",
                  "WORKER COMP",
                  "ADOPTION DECEPTION",
                  "TRESP",
                  "AGGRAVATED STALKING",
                  "SEND MINOR HARMFUL INFO.",
                  "MPERSON LEO COM. OF FEL",
                  "DEPRIVE OFFR OF PROTECT.",
                  "THREATS",
                  "THREAT",
                  "CONTEMPT",
                  "STORES HAZAR WASTE",
                  "INTERFERS W/CUSTODY PARENT/GUA",
                  "PUBLIC PEACE",
                  "KEEP FIREFIGHTER FROM DUTY",
                  "LIVE OFF PROSTIT.EARN",
                  "INTERFERS W/CUSTODY CHILD",
                  "INJ/KILL PD/FD/SAR ANIMAL",
                  "FALSE REPORT/ FAILURE MAKE REP",
                  "CONC.CRIME",
                  "CONSERVATION-OTHER",
                  "USE/CONCEAL/ATT.WPN-FELNY",
                  "INTRNET/F.S.",
                  "TORTURES ANIMAL",
                  "IMPERSONATE",
                  "FALS.RPRT",
                  'PAR.PERM',
                  "DESTROY,MULTI.BURIAL",
                  "FILLING PERSCRIPTIONS",
                  "RK/DMG FENCE",
                  "FEL/DELI",
                  "GAMBLING",
                  "DAMAGE COIN",
                  "DISCH.DESTRUCT.DEV.DAM.",
                  "CHILD SUPPORT",
                  "CRIM. TRANSMISSION HIV",
                  "SECURE FIREARM FROM MINOR",
                  "LITTER",
                  "CONSERVATION",
                  "PROC/UNLAWFUL",
                  "DISCH.DESTRUCT.",
                  "DISPLAY GUN",
                  "SOUND-RECORD",
                  "CAUSES POLLUTION",
                  "SER.INJ/NOT", #I do not know what this one is at all
                  "INTOX-MISD",
                  "OBSCENITY-OTHER",
                  "LIQUOR-OTHER",
                  "POACHING",
                  "DISCHARGING MACHINE GUN",
                  "WEAPON OFFENSE",
                  "FAIL GET FL. WC POLICY",
                  "W/MASK",
                  "POISON FOOD OR WATER",
                  "SHOOT/THROW OBJ.OCC.VEH.",
                  "BAIL BONDSMAN VIOL.",
                  "CONCEAL WPN NOT GUN-MISD.",
                  "bigamy",
                  "UNLICENSED PAWN BROKER",
                  "PRAC.HEALTH CARE",
                  "POSS CONC HANDCUFF KEY",
                  "POSS.5 OR MORE DEVICES",
                  "POSS.WPN.SCH/EVENT/BUS/STOP",
                  "WEAP.W/IN",
                  "INCENDIARY DEVICE-POSSESS",
                  "POSS/DISCH/MAKE DESTR. DEVICE",
                  "POSS.MANUF.FIRE BOMB",
                  "POSSESS WEAPON SCHOOL",
                  "POSS.FIREARM AT SCHOOL",
                  "PAR.AUTH.LET MINOR",
                  "HOAX BOMB",
                  "POSS.ELEC.WPN",
                  "POSSESS FIREARM WHEN PROHIB",
                  "ILGL.VEH.FUEL TRNSPRT",
                  "POSSES.FIREARM",
                  "TURTL/NEST/ETC",
                  "VEST"
                  )
```
  </p>
  </details>
  </li>
</ul>

<ul>
    <li>
      <details>
        <summary>Mapping to Formed Categories</summary>
        <p>
```{r}
category_mapping <- list(
  "Burglary and Theft" = burglary_theft_keywords,
  "Drug Offenses" = drug_offenses_keywords,
  "Violent Crimes" = violent_crimes_keywords,
  "Sex Crimes" = sex_crimes_keywords,
  "Crimes of Incarceration" = incarceration_related_crimes,
  "Property Crimes" = property_crimes,
  "White-Collar and Fraud" = white_collar_fraud_crimes,
  "Motor Vechile Crimes" = traffic_crimes,
  "Other" = other_crimes,
  "Probation/Parole Crimes" = probation_crimes,
  "Abuse/Neglect Crimes" = abuse_neglect_crimes)

returners_hist$crime_category <- NA
# Loop through categories and apply rules
for (category in names(category_mapping)) {
  keywords <- category_mapping[[category]]
  returners_hist$crime_category[grepl(paste(keywords, collapse = "|"), returners_hist$adjudicationcharge_desc, ignore.case = TRUE)] <- category
}
```
  </p>
  </details>
  </li>
</ul>


Okay did it today this is first pass on proportions of *current charges* of those who are currently incarcerated and have been incarcerated once before -- please understand that the work I did today needs double and triple-checked, and that I need to additionally do more work to allow a crime to fit into multiple categories, perhaps. Need to think about that more first, tbh. Anyhow, first pass on charges looks like this:

<ul>
    <li>
      <details>
        <summary>View Crime Category Mappings</summary>
        <p>

```{r}
#unmapped
unique(returners_hist[which(is.na(returners_hist$crime_category)),]$adjudicationcharge_descr)
```

        
### Burglary and Theft
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Burglary and Theft")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```
### Drug Offenses
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Drug Offenses")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Violent Crimes
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Violent Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Sex Crimes
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Sex Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Crimes of Incarceration
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Crimes of Incarceration")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Property Crimes
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Property Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### White-Collar and Fraud
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="White-Collar and Fraud")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```
### Motor Vechile Crimes
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Motor Vechile Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```
### Probation Violation/Parole Violation
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Probation/Parole Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Abuse/Neglect
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Abuse/Neglect Crimes")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```

### Other Crimes
```{r code_folding = TRUE}
datatable(unique(returners_hist %>% filter(crime_category=="Other")%>% select(adjudicationcharge_descr)), options = list(scrollX = TRUE, pageLength = 10, lengthMenu = c(10, 20, 50)))
```
        
  </p>
  </details>
  </li>
</ul>

```{r}
returners_hist$crime_category <- as.factor(returners_hist$crime_category)
category_counts <- summary(returners_hist$crime_category)
total_entries <- sum(category_counts)
category_percentages <- (category_counts / total_entries) * 100
rounded_percentages <- round(category_percentages, 2)
print(rounded_percentages)
```

I think the biggest problem with it right now is that I have many crimes coded as crimes of incarceration which should be more properly coded as Probation/Parole Violations (not crimes need to fix that too). Errors like that need to be sorted, it all needs double-checked, and then I need to validate the code once the data has been totally properly cleaned. Lots of work still, but this is a start.